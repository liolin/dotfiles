#+TITLE: Dekstop Configuration of liolin
#+PROPERTY: header-args :mkdirp yes
#+PROPERTY: header-args:sh :tangle-mode (identity #o444) :shebang #!/usr/bin/env bash
#+PROPERTY: header-args:css :tangle-mode (identity #o444)
#+PROPERTY: header-args:conf :tangle-mode (identity #o444)
#+PROPERTY: header-args:json :tangle-mode (identity #o444)
#+PROPERTY: header-args:yaml :tangle-mode (identity #o444)



tangle-mode:
- controls the permissions for the file
- #0555 = r+x
- #0444 = r
- [[https://orgmode.org/manual/Extracting-Source-Code.html][Extracting Source Code (The Org Manual)]]


* env
#+begin_src sh :tanle no
  PATH DEFAULT=${PATH}:@{HOME}/cargo/bin
  PATH DEFAULT=${PATH}:@{HOME}/.local/bin
  PATH DEFAULT=${PATH}:@{HOME}/dotnet/tools
  PATH DEFAULT=${PATH}:@{HOME}/.ghcup/bin
  PATH DEFAULT=${PATH}:@{HOME}/.cabal/bin
  PATH DEFAULT=${PATH}:@{HOME}/.bun/bin

  EDITOR DEFAULT="emacsclient -c -a emacs"
  VISUAL DEFAULT="emacsclient -c -a emacs"

  # Globals
  TZ=Europe/Zurich
  LANG=en_US.UTF-8

  # Environment-local
  CARGO_TARGET_DIR DEFAULT=@{HOME}/.cargo-target
  PATH DEFAULT=${PATH}:@{HOME}/.cargo-target/release/

  # Rust stuff
  RUST_BACKTRACE=1

  # .NET stuff
  DOTNET_CLI_TELEMETRY_OPTOUT=1

  # Java stuff
  _JAVA_AWT_WM_NONREPARENTING=1

  #export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
#+end_src

* ENV Variables
The following are the env variables which are valid over all shells.
They are included over =noweb= in the =profile= files for the specific shells.

#+NAME: ENV-VARS
#+begin_src sh :tanle no
  BUN_INSTALL="$HOME/.bun"
  PATH="$HOME/.cargo/bin:$PATH"
  PATH="$HOME/.dotnet/tools:$PATH"
  PATH="$HOME/.local/bin:$PATH"
  PATH="$HOME/.ebcli-virtual-env/executables:$PATH"
  PATH=$BUN_INSTALL/bin:$PATH


  if [ -d "/var/lib/flatpak/exports/share/applications" ] ; then
      XDG_DATA_DIRS="/var/lib/flatpak/exports/share/applications:$XDG_DATA_DIRS"
  fi

  if [ -d "$HOME/.local/share/flatpak/exports/share/applications" ] ; then
      XDG_DATA_DIRS="$HOME/.local/share/flatpak/exports/share/applications:$XDG_DATA_DIRS"
  fi

  [ -f "/home/liolin/.ghcup/env" ] && source "/home/liolin/.ghcup/env"

  #[ -f "/home/liolin/.nix-profile/etc/profile.d/nix.sh" ] && source "/home/liolin/.nix-profile/etc/profile.d/nix.sh"
  #[ -f "$HOME/.nix-profile/etc/profile.d/hm-session-vars.sh" ] && source "$HOME/.nix-profile/etc/profile.d/hm-session-vars.sh"

  export PATH
  export BUN_INSTALL
  export XDG_DATA_DIRS
  export BUN_INSTALL
  export ALTERNATE_EDITOR=""
  export EDITOR="emacsclient -c -a emacs"
  export VISUAL="emacsclient -c -a emacs"
  export DOTNET_CLI_TELEMETRY_OPTOUT=1
  export LEDGER_FILE="/home/liolin/org/finance/current.journal"
  export LANG=en_US.UTF-8
  export _JAVA_AWT_WM_NONREPARENTING=1
  export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
  export GTK_IM_MODULE=ibus
  export QT_IM_MODULE=ibus
  export XMODIFIERS=@im=ibus
  export CARGO_TARGET_DIR="$HOME/.cargo-target"
#+end_src

* org-protocol
#+begin_src conf :tangle ~/.local/share/applications/org-protocol.desktop
[Desktop Entry]
Name=org-protocol
Comment=Intercept calls from emacsclient to trigger custom actions
Categories=Other;
Keywords=org-protocol;
Icon=emacs
Type=Application
Exec=emacsclient -- %u
Terminal=false
StartupWMClass=Emacs
MimeType=x-scheme-handler/org-protocol;

#+end_src
* syncorg
** syncorg service
#+begin_src conf :tangle ~/.config/systemd/user/syncorg.service :tangle-mode (identity #o444)
  [Unit]
  Description=Sync org directory with Github

  [Service]
  Type=simple
  ExecStart=/home/liolin/.local/bin/syncorg

  [Install]
  WantedBy=default.target
#+end_src
** syncorg timer
#+begin_src conf :tangle ~/.config/systemd/user/syncorg.timer :tangle-mode (identity #o444)
  [Unit]
  Description=Sync org directory with Github

  [Timer]
  OnBootSec=0s
  OnUnitActiveSec=15m

  [Install]
  WantedBy=timers.target
#+end_src
** syncorg script
#+begin_src sh :tangle ~/.local/bin/syncorg :tangle-mode (identity #o555)
  #!/usr/bin/env bash
  set -Eeu

  export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)

  echo "Start"
  cd /home/liolin/org
  dirty=$(git status -s | grep -E "[a-zA-Z]" | wc -l)

if [ $dirty -gt 0 ]; then
    echo "Add new files"
    git add .
    git commit -m "Update using systemd.timer"
fi

  echo "Pull"
  git pull

  echo "Push"
  git push

  cd /home/liolin/roam
  dirty=$(git status -s | grep -E "[a-zA-Z]" | wc -l)

  if [ $dirty -gt 0 ]; then
      echo "Add new files"
      git add .
      git commit -m "Update"
  fi

  echo "Pull"
  git pull

  echo "Push"
  git push
#+end_src
* ical2org
** ical2org service
#+begin_src conf :tangle ~/.config/systemd/user/ical2org.service :tangle-mode (identity #o444)
  [Unit]
  Description=Convert ical to org

  [Service]
  Type=simple
  ExecStart=/home/liolin/.local/bin/ical2org

  [Install]
  WantedBy=default.target
#+end_src
** ical2org timer
#+begin_src conf :tangle ~/.config/systemd/user/ical2org.timer :tangle-mode (identity #o444)
  [Unit]
  Description=Convert ical to org

  [Timer]
  OnBootSec=0s
  OnUnitActiveSec=5m

  [Install]
  WantedBy=timers.target
#+end_src
** ical2org script
#+begin_src awk :tangle ~/.local/bin/ical2org.awk :tangle-mode (identity #o444)
  #!/usr/bin/env -S gawk -f
  # awk script for converting an iCal formatted file to a sequence of org-mode headings.
  # this may not work in general but seems to work for day and timed events from Google's
  # calendar, which is really all I need right now...
  #
  # usage:
  #   awk -f THISFILE < icalinputfile.ics > orgmodeentries.org
  #
  # Note: change org meta information generated below for author and
  # email entries!
  #
  # Caveats:
  #
  # - date entries with no time specified are assumed to be local time zone;
  #   same remark for date entries that do have a time but do not end with Z
  #   e.g.: 20130101T123456 is local and will be kept as 2013-01-01 12:34
  #   where 20130223T123422Z is UTC and will be corrected appropriately
  #
  # - UTC times are changed into local times, using the time zone of the
  #   computer that runs the script; it would be very hard in an awk script
  #   to respect the time zone of a file belonging to another time zone:
  #   the offsets will be different as well as the switchover time(s);
  #   (consider a remote shell to a computer with the file's time zone)
  #
  # - the UTC conversion entirely relies on the built-in strftime method;
  #   the author is not responsible for any erroneous conversions nor the
  #   consequence of such conversions
  #
  # - does process RRULE recurring events, but ignores COUNT specifiers
  #
  # - does not process EXDATE to exclude date(s) from recurring events
  #
  # Eric S Fraga
  # 20100629 - initial version
  # 20100708 - added end times to timed events
  #          - adjust times according to time zone information
  #          - fixed incorrect transfer for entries with ":" embedded within the text
  #          - added support for multi-line summary entries (which become headlines)
  # 20100709 - incorporated time zone identification
  #          - fixed processing of continuation lines as Google seems to
  #            have changed, in the last day, the number of spaces at
  #            the start of the line for each continuation...
  #          - remove backslashes used to protect commas in iCal text entries
  # no further revision log after this as the file was moved into a git
  # repository...
  #
  # Updated by: Guido Van Hoecke <guivhoATgmailDOTcom>
  # Last change: 2013.05.26 14:28:33
  #----------------------------------------------------------------------------------

  BEGIN {
      ### config section

      attending_types["UNSET"] = 0;
      attending_types["ATTENDING"] = 1;
      attending_types["NEEDS_ACTION"] = 2;
      attending_types["NOT_ATTENDING"] = 3;
      attending_types[0] = "UNSET";
      attending_types[1] = "ATTENDING";
      attending_types[2] = "NEEDS_ACTION";
      attending_types[3] = "NOT_ATTENDING";

      # map of UIDS for duplicate checking -- sometimes the same id comes down
      # with multiple VEVENTS
      UIDS[0];

      # map of people attending a given event
      people_attending[0];

      # maximum age in days for entries to be output: set this to -1 to
      # get all entries or to N>0 to only get enties that start or end
      # less than N days ago
      max_age = 7;

      # set to 1 or 0 to yes or not output a header block with TITLE,
      # AUTHOR, EMAIL etc...
      header = 1;

      # set to 1 or 0 to yes or not output the original ical preamble as
      # comment
      preamble = 1;

      # set to 1 to output time and summary as one line starting with
      # the time (value 1) or to 0 to output the summary as first line
      # and the date and time info as a later line (after the property
      # drawer or org complains)
      condense = 0;

      # set to 1 or 0 to yes or not output the original ical entry as a
      # comment (mostly useful for debugging purposes)
      original = 1;

      # google truncates long subjects with ... which is misleading in
      # an org file: it gives the unfortunate impression that an
      # expanded entry is still collapsed; value 1 will trim those
      # ... and value 0 doesn't touch them
      trimdots = 1;

      # change this to your name
      author = ENVIRON["AUTHOR"] != "" ? ENVIRON["AUTHOR"] : "Olivier Lischer"

      # and to your email address
      emailaddress = ENVIRON["EMAIL"] != "" ? ENVIRON["EMAIL"] : "olivier.lischer@ost.ch"

      # main title of the Org file
      title = ENVIRON["TITLE"] != "" ? ENVIRON["TITLE"] : "OST Calendar"

      # calendar/category name for display in org-mode
      calendarname = ENVIRON["CALENDAR"] != "" ? ENVIRON["CALENDAR"] : "OST Calendar"

      # any tags for this calendar (e.g. "WORK" or "PERSONAL")
      filetags = ENVIRON["FILETAGS"] != "" ? ENVIRON["FILETAGS"] : "OST"

      # timezone offsets
      # TODO: this is stupid
      tz_offsets["America/Los_Angeles"] = 0
      tz_offsets["America/Chicago"] = 2

      ### end config section

      # use a colon to separate the type of data line from the actual contents
      FS = ":";

      # we only need to preserve the original entry lines if either the
      # preamble or original options are true
      preserve = preamble || original
      first = 1;      # true until an event has been found
      max_age_seconds = max_age*24*60*60

      if (header) {
          print "#+TITLE:      ", title
          print "#+AUTHOR:     ", author
          print "#+EMAIL:      ", emailaddress
          print "#+DESCRIPTION: converted using the ical2org awk script"
          print "#+CATEGORY:   ", calendarname
          print "#+STARTUP:     hidestars"
          print "#+STARTUP:     overview"
          print "#+FILETAGS:   ", filetags
          print ""
      }
  }

  # continuation lines (at least from Google) start with a space. If the
  # continuation is after a processed field (description, summary, attendee,
  # etc.) append the entry to the respective variable
  /^[ ]/ {
      if (indescription) {
          entry = entry gensub("\r", "", "g", gensub("^[ ]", "", 1, $0));
          # print "entry continuation: " entry
      } else if (insummary) {
          summary = summary gensub("\r", "", "g", gensub("^[ ]", "", 1, $0))
          # print "summary continuation: " summary
      } else if (inattendee) {
          attendee = attendee gensub("\r", "", "g", gensub("^[ ]", "", 1, $0))
          # print "attendee continuation: " attendee
          are_we_going(attendee)
          add_attendee(attendee)
      } else if (inlocation) {
          location = location unescape(gensub("\r", "", "g", $0), 0);

      }
      if (preserve)
          icalentry = icalentry "\n" $0
  }

  /^BEGIN:VEVENT/ {
      # start of an event: initialize global values used for each event
      date = "";
      entry = ""
      headline = ""
      icalentry = ""  # the full entry for inspection
      id = ""
      indescription = 0;
      insummary = 0
      inattendee = 0
      inlocation = 0
      in_alarm = 0
      got_end_date = 0
      attending = attending_types["UNSET"];
      # http://unix.stackexchange.com/a/147958/129055
      intfreq = "" # the interval and frequency for repeating org timestamps
      lasttimestamp = -1;
      location = ""
      rrend = ""
      status = ""
      summary = ""
      attendee = ""
      delete people_attending;

      # if this is the first event, output the preamble from the iCal file
      if (first) {
          if(preamble) {
              print "* COMMENT original iCal preamble"
              print gensub("\r", "", "g", icalentry)
          }
          if (preserve)
              icalentry = ""
          first = 0;
      }
  }

  # any line that starts at the left with a non-space character is a new data field

  /^BEGIN:VALARM/ {
      # alarms have their own UID, DESCRIPTION, etc. We don't want these polluting the real fields
      in_alarm = 1
  }

  /^END:VALARM/ {
      in_alarm = 0
  }

  /^[A-Z]/ {
      # we do not copy DTSTAMP lines as they change every time you download
      # the iCal format file which leads to a change in the converted
      # org file as I output the original input.  This change, which is
      # really content free, makes a revision control system update the
      # repository and confuses.
      if (preserve)
          if (! index("DTSTAMP", $1))
              icalentry = icalentry "\n" $0
      # this line terminates the collection of description and summary entries
      indescription = 0;
      insummary = 0;
      inattendee = 0;
  }

  # this type of entry represents a day entry, not timed, with date stamp YYYYMMDD

  /^DTSTART;VALUE=DATE[^-]/ {
      date = datestring($2);
  }

  /^DTEND;VALUE=DATE[^-]/ {
      got_end_date = 1
      end_date = datestring($2, 1);
      if ( issameday )
          end_date = ""
  }


  # this represents a timed entry with date and time stamp YYYYMMDDTHHMMSS
  # we ignore the seconds
  /^DTSTART[:;][^V]/ {
      tz = "";
      match($0, /TZID=([^:]*)/, a)
      {
          tz = a[1];
      }
      offset = tz_offsets[tz]

      date = datetimestring($2, offset);
      # print date;

      if (date != "" && got_end_date) {
          fix_date_time()
      }
  }

  # and the same for the end date;

  /^DTEND[:;][^V]/ {
      # NOTE: this doesn't necessarily appear after DTSTART
      tz = "";
      match($0, /TZID=([^:]*)/, a)
      {
          tz = a[1];
      }
      offset = tz_offsets[tz]

      end_date = datetimestring($2, offset);
      got_end_date = 1

      if (date != "" && got_end_date) {
          # We got start and end date/time, let's munge as appropriate
          fix_date_time()
      }
  }


  # this represents a timed entry with a UTC datetime stamp YYYYMMDDTHHMMSSZ
  # we ignore the seconds
  /^DTSTART[:;]VALUE=DATE-TIME/ {
      tz = "";
      offset = tz_offsets[tz]

      date = datetimestring($2, offset);
      # print date;

      if (date != "" && got_end_date) {
          fix_date_time()
      }
  }

  # and the same for the end date;

  /^DTEND[:;]VALUE=DATE-TIME/ {
      # NOTE: this doesn't necessarily appear after DTSTART
      tz = "";
      offset = tz_offsets[tz]

      end_date = datetimestring($2, offset);
      got_end_date = 1

      if (date != "" && got_end_date) {
          # We got start and end date/time, let's munge as appropriate
          fix_date_time()
      }
  }


  # repetition rule

  /^RRULE:FREQ=(DAILY|WEEKLY|MONTHLY|YEARLY)/ {
      # TODO: handle BYDAY values for events that repeat weekly for multiple days
      # (e.g. a "Gym" event)

      # get the d, w, m or y value
      freq = tolower(gensub(/.*FREQ=(.).*/, "\\1", 1, $0))
      # get the interval, and use 1 if none specified
      interval =  $2 ~ /INTERVAL=/ ? gensub(/.*INTERVAL=([0-9]+);.*/, "\\1", 1, $2) : 1
      # get the enddate of the rule and use "" if none specified
      rrend = $2 ~ /UNTIL=/ ? datestring(gensub(/.*UNTIL=([0-9]{8}).*/, "\\1", 1, $2)) : ""
      rrend_raw = $2 ~ /UNTIL=/ ? gensub(/.*UNTIL=([0-9]{8}).*/, "\\1", 1, $2) : ""
      repeat_count = $2 ~ /COUNT=/ ? gensub(/.*COUNT=([0-9]+).*/, "\\1", 1, $2) : ""
      # build the repetitor vale as understood by org
      intfreq =  " +" interval freq
      # if the repetition is daily, and there is an end date, drop the repetitor
      # as that is the default
      if (intfreq == " +1d" && end_date == "" && rrend != "")
          intfreq = ""
      now = strftime("%Y%m%dT%H%M%SZ")
      if (rrend_raw != "" && rrend_raw < now)
          intfreq = ""
      if (repeat_count != "")      # TODO: count repeats correctly
          intfreq = ""
  }

  # The description will the contents of the entry in org-mode.
  # this line may be continued.

  /^DESCRIPTION/ {
      if (!in_alarm) {
          # Setting $1 to "" clears colons from items like "1:1 with Marc", so we
          # strip "DESCRIPTION:" off of the front instead
          # $1 = "";
          entry = entry gensub("\r", "", "g", gensub(/^DESCRIPTION:/, "", 1, $0));
          indescription = 1;
      }
  }

  # the summary will be the org heading

  /^SUMMARY/ {
      # Setting $1 to "" clears colons from items like "1:1 with Marc", so we
      # strip "SUMMARY:" off of the front instead
      if (!in_alarm) {
         summary = gensub("\r", "", "g", gensub(/^SUMMARY:/, "", 1, $0));

         # trim trailing dots if requested by config option
         if(trimdots && summary ~ /\.\.\.$/)
             sub(/\.\.\.$/, "", summary)
         insummary = 1;
         # print "Summary: " summary
      }
  }

  # the unique ID will be stored as a property of the entry

  /^UID/ {
      if (!in_alarm) {
          id = gensub("\r", "", "g", $2);
      }
  }

  /^LOCATION/ {
      location = unescape(gensub("\r", "", "g", $2), 0);
      inlocation = 1;
      # print "Location: " location
  }

  /^STATUS/ {
      status = gensub("\r", "", "g", $2);
      # print "Status: " status
  }

  /^ATTENDEE/ {
      attendee = gensub("\r", "", "g", $0);
      inattendee = 1;
      # print "Attendee: " attendee
  }

  # when we reach the end of the event line, we output everything we
  # have collected so far, creating a top level org headline with the
  # date/time stamp, unique ID property and the contents, if any

  /^END:VEVENT/ {
      #output event
      # print "max_age: " max_age
      # print "lasttimestamp: " lasttimestamp
      # print "lasttimestamp+max_age_seconds: " lasttimestamp+max_age_seconds
      # print "systime(): " systime()

      is_duplicate = (id in UIDS);
      if(is_duplicate == 0 && (max_age<0 || intfreq != "" || ( lasttimestamp>0 && systime()<lasttimestamp+max_age_seconds )) )
      {
          if (attending != attending_types["NOT_ATTENDING"]) {
              # build org timestamp
              if (intfreq != "")
                  date = date intfreq
              # TODO: http://orgmode.org/worg/org-faq.html#org-diary-class
              else if (end_date != "")
                  date = date ">--<" end_date
              else if (rrend != "")
                  date = date ">--<" rrend

              # translate \n sequences to actual newlines and unprotect commas (,)
              if (condense)
                  print "* <" date "> " gensub("^[ ]+", "", "", unescape(summary, 0))
              else
                  print "* " gensub("^[ ]+", "", "g", unescape(summary, 0))
              print "  :PROPERTIES:"
              print     "  :ID:        " id
              if(length(location))
                  print "  :LOCATION:  " location
              if(length(status))
                  print "  :STATUS:    " status
              attending_string = attending_types[attending]
              if(attending_string == "UNSET")
                  # No attending info at all -- assume this is an event we
                  # created to block off our calendar, with no attendees, and
                  # mark it as attending
                  attending_string = "ATTENDING"
              print "  :ATTENDING: " attending_string
              print "  :ATTENDEES: " join_keys(people_attending)
              print "  :END:"
              if (date2 != "")
              {
                  # Fake some logbook entries so we can generate a clock report
                  print "  :LOGBOOK:"
                  print "  CLOCK: [" date1 "]--[" date2 "] =>  " "0:00"
                  print "  :END"
              }
              if (!condense)
                   print "<" date ">"

              print ""
              if(length(entry)>1)
                  print gensub("^[ ]+", "", "g", unescape(entry, 1));

              # output original entry if requested by 'original' config option
              if (original)
                  print "** COMMENT original iCal entry\n", gensub("\r", "", "g", icalentry)
          }
          UIDS[id] = 1;
      }
  }


  # Join keys in an array, return a string
  function join_keys(input)
  {
      joined = "";
      first_key = 1;
      for (key in input)
      {
          if (first_key != 1)
              joined = joined ", "
          joined = joined key
          first_key = 0;
      }
      return joined;
  }


  # unescape commas, newlines, etc. newlines are optionally converted to just
  # spaces -- it's good to preserve them in descriptions for e.g. interview
  # calendar events, but addresses look better with spaces as more info fits on a
  # line
  function unescape(input, preserve_newlines)
  {
      ret = gensub("\\\\,", ",", "g",
                   gensub("\\\\;", ";", "g", input))
      if (preserve_newlines)
          ret = gensub("\\\\n", "\n", "g", ret)
      else
          ret = gensub("\\\\n", " ", "g", ret)
      return ret
      # return gensub("\\\\,", ",", "g",
      #               gensub("\\\\n", " ", "g",
      #                       gensub("\\\\;", ";", "g", input)))
  }


  # funtion to convert an iCal time string 'yyyymmddThhmmss[Z]' into a
  # date time string as used by org, preferably including the short day
  # of week: 'yyyy-mm-dd day hh:mm' or 'yyyy-mm-dd hh:mm' if we cannot
  # define the day of the week

  function datetimestring(input, offset)
  {
      # print "________"
      # print "input : " input
      # convert the iCal Date+Time entry to a format that mktime can understand
      spec  = match(input, "([0-9]{4})([0-9]{2})([0-9]{2})T([0-9]{2})([0-9]{2})([0-9]{2}).*[\r]*", a);
      year = a[1]
      month = a[2]
      day = a[3]
      hour = a[4]
      min = a[5]
      sec = a[6]
      # print "spec :" spec

      if (offset > 0)
      {
          hour -= offset
      }

      # print "input: " input
      # print "datetime: " year" "month" "day" "hour" "min" "sec
      stamp = mktime(year" "month" "day" "hour" "min" "sec);
      lasttimestamp = stamp;

      if (stamp <= 0) {
          # this is a date before the start of the epoch, so we cannot
          # use strftime and will deliver a 'yyyy-mm-dd hh:mm' string
          # without day of week; this assumes local time, and does not
          # attempt UTC offset correction
          spec = gensub("([0-9]{4})([0-9]{2})([0-9]{2})T([0-9]{2})([0-9]{2})([0-9]{2}).*[\r]*", "\\1-\\2-\\3 \\4:\\5", "g", input);
          # print "==> spec:" spec;
          return spec;
      }

      if (input ~ /[0-9]{8}T[0-9]{6}Z/ ) {
          # this is an utc time;
          # we need to correct the timestamp by the utc offset for this time
          offset = strftime("%z", stamp)
          pm = substr(offset,1,1) 1 # define multiplier +1 or -1
          hh = substr(offset,2,2) * 3600 * pm
          mm = substr(offset,4,2) * 60 * pm

          # adjust the timestamp
          stamp = stamp + hh + mm
      }

      return strftime("%Y-%m-%d %a %H:%M", stamp);
  }

  # function to convert an iCal date into an org date;
  # the optional parameter indicates whether this is an end date;
  # for single or multiple whole day events, the end date given by
  # iCal is the date of the first day after the event;
  # if the optional 'isenddate' parameter is non zero, this function
  # tries to reduce the given date by one day

  function datestring(input, isenddate)
  {
      #convert the iCal string to a an mktime input string
      spec = gensub("([0-9]{4})([0-9]{2})([0-9]{2}).*[\r]*", "\\1 \\2 \\3 00 00 00", "g", input);

      # compute the nr of seconds after or before the epoch
      # dates before the epoch will have a negative timestamp
      # days after the epoch will have a positive timestamp
      stamp = mktime(spec);

      if (isenddate) {
          # subtract 1 day from the timestamp
          # note that this also works for dates before the epoch
          stamp = stamp - 86400;

          # register whether the end date is same as the start date
          issameday = lasttimestamp == stamp
      }
      # save timestamp to allow for check of max_age
      lasttimestamp = stamp

      if (stamp < 0) {
          # this date is before the epoch;
          # the returned datestring will not have the short day of week string
          # as strftime does not handle negative times;
          # we have to construct the datestring directly from the input
          if (isenddate) {
              # we really should return the date before the input date, but strftime
              # does not work with negative timestamp values; so we can not use it
              # to obtain the string representation of the corrected timestamp;
              # we have to return the date specified in the iCal input and we
              # add time 00:00 to clarify this
              return spec = gensub("([0-9]{4})([0-9]{2})([0-9]{2}).*[\r]*", "\\1-\\2-\\3 00:00", "g", input);
          } else {
              # just generate the desired representation of the input date, without time;
              return gensub("([0-9]{4})([0-9]{2})([0-9]{2}).*[\r]*", "\\1-\\2-\\3", "g", input);
          }
      }

      # return the date and day of week
      return strftime("%Y-%m-%d %a", stamp);
  }

  # Add the current attendee's response to a set, so we can list who's going
  # and who's declined
  function add_attendee(attendee)
  {
      match(attendee, /CN=([^;]+)/, m)
      {
          CN = tolower(m[1]);
          people_attending[CN] = 1;
      }
  }

  function fix_date_time()
  {
      if (substr(date,1,10) == substr(end_date,1,10)) {
          # timespan within same date, use one date with a time range, but preserve
          # original dates for org-clocktable
          date1 = date
          date2 = end_date

          date = date "-" substr(end_date, length(end_date)-4)
          end_date = ""
      }
  }

  # Parse the current ATTENDEE line and see if it belongs to us. If so, check if
  # we've accepted this calendar invite, and if so, set `attending` to True. It
  # may be the case that there are no attendees (e.g. personal calendar items),
  # and if that's the case, we'll leave `attending` unset. If there are attendees,
  # we'll parse our status out and set `attending` appropriately.
  function are_we_going(attendee)
  {
      if (attending != attending_types["UNSET"])
      {
          # print "Bailing out early, attending is " attending
          return;
      }

      match(attendee, /CN=([^;]+)/, m)
      {
          # CN's can optionally be surrounded by quotes (google calendar download
          # omits, apple calendar export includes them)
          CN = gensub("\"", "", "g", tolower(m[1]));
          # TODO: no hardcoding
          if (CN == tolower(author) || CN == tolower(emailaddress))
          {
              # This is us -- did we accept the meeting?
              if (attendee ~ /PARTSTAT=ACCEPTED/)
              {
                  attending = attending_types["ATTENDING"];
              }
              else if (attendee ~ /PARTSTAT=NEEDS-ACTION/)
              {
                  attending = attending_types["NEEDS_ACTION"];
              }
              else {
                  attending = attending_types["NOT_ATTENDING"];
              }
          }
      }
      # print "are_we_going: " attending
  }

  # Local Variables:
  # time-stamp-line-limit: 1000
  # time-stamp-format: "%04y.%02m.%02d %02H:%02M:%02S"
  # time-stamp-active: t
  # time-stamp-start: "Last change:[ \t]+"
  # time-stamp-end: "$"
  # End:
#+end_src
#+begin_src sh :tangle ~/.local/bin/ical2org :tangle-mode (identity #o555)
  set -Eeu

  URL=$(cat ~/.credentials/ost_calendar)
  export EMAIL="olivier.lischer@ost.ch"
  export TITLE="OST Calendar"
  export CALENDAR="OST"
  export FILETAGS="WORK"
  curl -sL "${URL}" | awk -f /home/liolin/.local/bin/ical2org.awk > /home/liolin/org/Agenda/calendar_ost.org

  URL=$(cat ~/.credentials/gmail_calendar)
  export EMAIL="olivier.lischer.blon@gmail.com"
  export TITLE="Google Calendar"
  export CALENDAR="Google"
  export FILETAGS="PERSONAL"
  curl -sL "${URL}" | awk -f /home/liolin/.local/bin/ical2org.awk > /home/liolin/org/Agenda/calendar_gmail.org
#+end_src
* Alacritty
:PROPERTIES:
:header-args:toml: :tangle ~/.config/alacritty/alacritty.toml :tangle-mode (identity #o555)
:END:
** Window
#+begin_src toml
  [window]
  opacity = 0.9
#+end_src
** Font
#+begin_src toml
  [font]
  size = 11.0

  [font.bold]
  style = "Bold"

  [font.bold_italic]
  style = "Bold Italic"

  [font.italic]
  style = "Italic"

  [font.normal]
  family = "Fira Code Nerd Font"
  style = "Regular"
#+end_src
** Colors
I use a the dracula theme from [[https://draculatheme.com/alacritty][here]].
#+begin_src toml
  # Base16 Gruvbox dark, hard 256 - alacritty color config
  # Dawid Kurek (dawikur@gmail.com), morhetz (https://github.com/morhetz/gruvbox)

  # Default colors
  [colors.primary]
  background = '0x1d2021'
  foreground = '0xd5c4a1'

  # Colors the cursor will use if `custom_cursor_colors` is true
  [colors.cursor]
  text = '0x1d2021'
  cursor = '0xd5c4a1'

  # Normal colors
  [colors.normal]
  black = '0x1d2021'
  red = '0xfb4934'
  green = '0xb8bb26'
  yellow = '0xfabd2f'
  blue = '0x83a598'
  magenta = '0xd3869b'
  cyan = '0x8ec07c'
  white = '0xd5c4a1'

  # Bright colors
  [colors.bright]
  black = '0x665c54'
  red = '0xfb4934'
  green = '0xb8bb26'
  yellow = '0xfabd2f'
  blue = '0x83a598'
  magenta = '0xd3869b'
  cyan = '0x8ec07c'
  white = '0xfbf1c7'

  [[colors.indexed_colors]]
  index = 16
  color = "0xfe8019"

  [[colors.indexed_colors]]
  index = 17
  color = "0xd65d0e"

  [[colors.indexed_colors]]
  index = 18
  color = "0x3c3836"

  [[colors.indexed_colors]]
  index = 19
  color = "0x504945"

  [[colors.indexed_colors]]
  index = 20
  color = "0xbdae93"

  [[colors.indexed_colors]]
  index = 21
  color = "0xebdbb2"
#+end_src

** Keyboard
#+begin_src toml
#+end_src
** Required Packages                                               :packages:
#+begin_example
alacritty
#+end_example

* Kitty
:PROPERTIES:
:header-args:conf: :tangle ~/.config/kitty/kitty.conf :tangle-mode (identity #o555)
:END:
** Window
#+begin_src conf
  background_opacity  0.9
#+end_src
** Font
#+begin_src conf
  font_family      "Fira Code Nerd Font"
  bold_font        auto
  italic_font      auto
  bold_italic_font auto
  font_size        11.0
#+end_src
** Colors
#+begin_src conf
  # Base16 Gruvbox dark, hard 256 - alacritty color config
  # Dawid Kurek (dawikur@gmail.com), morhetz (https://github.com/morhetz/gruvbox)

  cursor                  #928374
  cursor_text_color       background

  url_color               #83a598

  visual_bell_color       #8ec07c
  bell_border_color       #8ec07c

  active_border_color     #d3869b
  inactive_border_color   #665c54

  foreground              #ebdbb2
  background              #282828
  selection_foreground    #928374
  selection_background    #ebdbb2

  active_tab_foreground   #fbf1c7
  active_tab_background   #665c54
  inactive_tab_foreground #a89984
  inactive_tab_background #3c3836

  # black  (bg3/bg4)
  color0                  #665c54
  color8                  #7c6f64

  # red
  color1                  #cc241d
  color9                  #fb4934

  #: green
  color2                  #98971a
  color10                 #b8bb26

  # yellow
  color3                  #d79921
  color11                 #fabd2f

  # blue
  color4                  #458588
  color12                 #83a598

  # purple
  color5                  #b16286
  color13                 #d3869b

  # aqua
  color6                  #689d6a
  color14                 #8ec07c

  # white (fg4/fg3)
  color7                  #a89984
  color15                 #bdae93
#+end_src

** Required Packages                                               :packages:
#+begin_example
kitty
#+end_example

* Bash
** profile
#+begin_src sh
  <<ENV-VARS>>
#+end_src
** bash_profile
#+begin_src sh
  <<ENV-VARS>>

  [ -r "~/.bashrc" ] && source ~/.bashrc
#+end_src
** Guard
#+begin_src sh :tangle ~/.bashrc :tangle-mode (identity #o555)
  [[ $- != *i* ]] && return
#+end_src

** Alias
#+begin_src sh :tangle ~/.bashrc :tangle-mode (identity #o555)
  alias ls='eza'
  alias ll='eza -la'   # show long listing of all except ".."
  alias rm='rm -I'
  alias mv='mv -i'
  alias cp='cp -i'
  alias mount-share='systemctl start home-liolin-shares-ds.mount'
  alias batstat='upower -i /org/freedesktop/UPower/devices/battery_BAT0'
  alias syncost='rsync -avz /home/liolin/ownCloud/Private/ost/ /home/liolin/shares/ds/Documents/01_School/02_HSR/01_Unterrichtsunterlagen/06_Semester/'
  alias syncmail='rsync -avz /home/liolin/.mail/ /home/liolin/shares/ds/Documents/00_Private/99_mailArchive/'
  alias gp='git push'
  alias gpu='git pull'
  alias gc='git commit'
  alias ga='git add'
#+end_src

** starship
#+begin_src sh :tangle ~/.bashrc :tangle-mode (identity #o555)
  eval "$(starship init bash)"
#+end_src

** includes
#+begin_src sh :tangle ~/.bashrc :tangle-mode (identity #o555)
  source /usr/share/fzf/key-bindings.bash
  source /usr/share/fzf/completion.bash
  [ -f "/opt/miniconda3/etc/profile.d/conda.sh" ] && source /opt/miniconda3/etc/profile.d/conda.sh
#+end_src

** SSH
#+begin_src sh :tangle ~/.bashrc :tangle-mode (identity #o555)
  export GPG_TTY="$(tty)"
#+end_src

** Required Packages                                               :packages:
#+begin_example
eza
upower
rsync
starship
fzf
bash-completion
(miniconda)
#+end_example

* Dunst
** Global
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  [global]
#+end_src

*** Display
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  monitor = 0
  follow = none
  geometry = "300x5-30+20"
  indicate_hidden = yes
  shrink = no
  transparency = 10
  notification_height = 0
  separator_height = 2
  progress_bar = true

  # Padding between text and separator.
  padding = 8
  horizontal_padding = 8
  frame_width = 3
  frame_color = "#1d2021"
  separator_color = frame

  # Sort messages by urgency.
  sort = yes

  # Don't remove messages, if the user is idle (no mouse or keyboard input)
  # for longer than idle_threshold seconds.
  idle_threshold = 120
#+end_src

*** Text
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  font = Monospace 10
  line_height = 0
  markup = full
  format = "<b>%s</b>\n%b"
  alignment = left
  show_age_threshold = 60
  word_wrap = yes
  ellipsize = middle
  ignore_newline = no
  stack_duplicates = true
  hide_duplicate_count = false
  show_indicators = yes
#+end_src

*** TODO Icons
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  icon_position = left
  max_icon_size = 64
  icon_theme = Papirus-Dark
  enable_recursive_icon_lookup=true
#+end_src

*** History
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  # Should a notification popped up from history be sticky or timeout
  # as if it would normally do.
  sticky_history = yes

  # Maximum amount of notifications kept in history
  history_length = 20
#+end_src

*** Misc / Advanced
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  dmenu = /usr/bin/dmenu -p dunst:
  browser = /usr/bin/firefox -new-tab

  # Always run rule-defined scripts, even if the notification is suppressed
  always_run_script = true

  # Define the title of the windows spawned by dunst
  title = Dunst

  # Define the class of the windows spawned by dunst
  class = Dunst
  startup_notification = false
  verbosity = mesg
  corner_radius = 0
#+end_src

*** Legacy
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  # Use the Xinerama extension instead of RandR for multi-monitor support.
  # This setting is provided for compatibility with older nVidia drivers that
  # do not support RandR and using it on systems that support RandR is highly
  # discouraged.
  #
  # By enabling this setting dunst will not be able to detect when a monitor
  # is connected or disconnected which might break follow mode if the screen
  # layout changes.
  force_xinerama = false
#+end_src

*** Mouse
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  mouse_left_click = close_current
  mouse_middle_click = do_action
  mouse_right_click = close_all
#+end_src

** Shortcuts
Configure your DE / WM to call =dunstctl=.
** Urgency
#+begin_src conf :tangle ~/.config/dunst/dunstrc
  # vim: filetype=yaml
  # dunst template
  # Base16 Gruvbox dark, hard Dark, by Dawid Kurek (dawikur@gmail.com), morhetz (https://github.com/morhetz/gruvbox)

  [urgency_low]
      background = "#1d2021"
      foreground = "#fbf1c7"

  [urgency_normal]
      background = "#1d2021"
      foreground = "#83a598"

  [urgency_critical]
      background = "#1d2021"
      foreground = "#fb4934"
#+end_src

** Required Packages                                               :packages:
#+begin_example
dunst
#+end_example

* Etc
See [[file:system.org][system.org]]
* fish
** config.fish
#+begin_src sh :tangle ~/.config/fish/config.fish
  set PATH "$HOME/.cargo/bin" $PATH
  set PATH "$HOME/.local/bin" $PATH
  set PATH "$HOME/dotnet/tools" $PATH
  set PATH "$HOME/.ghcup/bin" $PATH
  set PATH "$HOME/.cabal/bin" $PATH
  set -gx PATH "$HOME/.bun/bin" $PATH

  set -gx EDITOR "emacsclient -c -a emacs"
  set -gx VISUAL "emacsclient -c -a emacs"

  # Globals
  set -gx TZ "Europe/Zurich"
  set -gx LANG "en_US.UTF-8"

  # Environment-local
  set -gx CARGO_TARGET_DIR "$HOME/.cargo-target"
  set -gx PATH "$HOME/.cargo-target/release/" $PATH

  # Rust stuff
  set -gx RUST_BACKTRACE 1

  # .NET stuff
  set -gx DOTNET_CLI_TELEMETRY_OPTOUT 1

  # Java stuff
  set -gx _JAVA_AWT_WM_NONREPARENTING 1

  # OCaml Stuff
  eval (opam env)

  # SSH / GPG
  gpgconf --launch gpg-agent
  set -gx SSH_AUTH_SOCK (gpgconf --list-dirs agent-ssh-socket)
  gpg-connect-agent updatestartuptty /bye >> /dev/null

  # hledger
  set -gx LEDGER_FILE "$HOME/org/finance/current.journal"

  # Run sway on login
  set TTY (tty)
  if [ $TTY = "/dev/tty1" ]
     bass source /etc/profile.d/flatpak.sh
     exec sway --unsupported-gpu
  end

  if [ $TTY = "/dev/tty2" ]
     exec startx
  end

  if status is-interactive
     alias l="eza"
     alias ls="eza"
     alias ll="eza -la"   # show long listing of all except ".."
     alias cp="cp -i"
     alias mv="mv -i"
     alias cat="bat -p"
     alias mount-share="systemctl start home-liolin-shares-ds.mount"
     alias batstat="upower -i /org/freedesktop/UPower/devices/battery_BAT0"
     alias syncost="rsync -avz /home/liolin/ownCloud/Private/ost/ /home/liolin/shares/ds/Documents/01_School/02_HSR/01_Unterrichtsunterlagen/06_Semester/"
     alias syncmail="rsync -avz /home/liolin/.mail/ /home/liolin/shares/ds/Documents/00_Private/99_mailArchive/"
     alias gp="git push"
     alias gpu="git pull"
     alias gc="git commit"
     alias ga="git add"
     alias cdr="cd ~/roam/"
     alias cdo="cd ~/org/"
     alias hsc="hledger bs assets:cash:post:student -C"
     alias hs="hledger bs assets:cash:post:student"
     alias hrc="hledger bs assets:cash:revolut -C"
     alias hr="hledger bs assets:cash:revolut"
     alias tree="eza --tree"
     alias em="emacsclient -nw"

     base16-gruvbox-dark-hard
     starship init fish | source
     zoxide init --cmd cd fish | source
  end
#+end_src
** nix.fish
#+begin_src sh :tangle ~/.config/fish/conf.d/nix.fish
  if test -e '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.fish'
    . '/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.fish'
  end
#+end_src
** direnv.fish
#+begin_src sh :tangle ~/.config/fish/conf.d/direnv.fish
  if test -x (which direnv)
     direnv hook fish | source
  end
#+end_src
** funtions
#+begin_src sh :tangle ~/.config/fish/functions/fish_user_key_bindings.fish
  function fish_user_key_bindings
    fzf_key_bindings
  end
#+end_src

#+begin_src sh :tangle ~/.config/fish/functions/yta.fish
  function yta
    mpv --ytdl-format=bestaudio "$argv"
  end
#+end_src

#+begin_src sh :tangle ~/.config/fish/functions/opn.fish
  function opn
    xdg-open "$argv" &
  end
#+end_src

#+begin_src sh :tangle ~/.config/fish/functions/remind.fish
  # Converted from bash to fish
  # https://opensource.com/article/22/1/linux-desktop-notifications
  function remind
        set COUNT (count $argv)
        set COMMAND $argv[1]
        set MESSAGE $argv[1]
        set OPERATION $argv[2]
        set WHEN $argv[3..]

        if test $COUNT = 0; or test $COMMAND = "help";
          echo "COMMAND"
          echo "    remind <message> <time>"
          echo "    remind <command>"
          echo
          echo "DESCRIPTION"
          echo "    Displays notification at specified time"
          echo
          echo "EXAMPLES"
          echo '    remind "Hi there" now'
          echo '    remind "Time to wake up" in 5 minutes'
          echo '    remind "Dinner" in 1 hour'
          echo '    remind "Take a break" at noon'
          echo '    remind "Are you ready?" at 13:00'
          echo '    remind list'
          echo '    remind clear'
          echo '    remind help'
          echo
          return
        end

        if not test -x (which at)
          echo "remind: AT utility is required but not installed on your system. Install it with your package manager of choice, for example 'sudo apt install at'."
          return
        end

        if test $COUNT = 1
           if test $COMMAND = "list"
            at -l
           else if test $COMMAND = "clear"
             at -r (atq | cut -f1)
           else
             echo "remind: unknown command $COMMAND. Type 'remind' without any parameters to see syntax."
           end
           return
        end

        if test $OPERATION = "in"
           set TIME "now + $WHEN"
        else if test $OPERATION = "at"
           set TIME "$WHEN"
        else if test $OPERATION = "now"
           set TIME "now"
        else
         echo "remind: invalid time operator $OP"
         return
        end

        echo "dunstify '$MESSAGE' 'Reminder' -u critical" | at $TIME 2>/dev/null
        echo "Notification scheduled at $TIME"
  end
#+end_src

#+begin_src sh :tangle ~/.config/fish/functions/base16-gruvbox-dark-hard.fish
  # base16-fish (https://github.com/tomyun/base16-fish)
  # based on base16-shell (https://github.com/chriskempson/base16-shell)
  # Gruvbox dark, hard scheme by Dawid Kurek (dawikur@gmail.com), morhetz (https://github.com/morhetz/gruvbox)

  function base16-gruvbox-dark-hard -d "Gruvbox dark, hard"
    set color00 1d/20/21 # Base 00 - Black
    set color01 fb/49/34 # Base 08 - Red
    set color02 b8/bb/26 # Base 0B - Green
    set color03 fa/bd/2f # Base 0A - Yellow
    set color04 83/a5/98 # Base 0D - Blue
    set color05 d3/86/9b # Base 0E - Magenta
    set color06 8e/c0/7c # Base 0C - Cyan
    set color07 d5/c4/a1 # Base 05 - White
    set color08 66/5c/54 # Base 03 - Bright Black
    set color09 $color01 # Base 08 - Bright Red
    set color10 $color02 # Base 0B - Bright Green
    set color11 $color03 # Base 0A - Bright Yellow
    set color12 $color04 # Base 0D - Bright Blue
    set color13 $color05 # Base 0E - Bright Magenta
    set color14 $color06 # Base 0C - Bright Cyan
    set color15 fb/f1/c7 # Base 07 - Bright White
    set color16 fe/80/19 # Base 09
    set color17 d6/5d/0e # Base 0F
    set color18 3c/38/36 # Base 01
    set color19 50/49/45 # Base 02
    set color20 bd/ae/93 # Base 04
    set color21 eb/db/b2 # Base 06
    set colorfg $color07 # Base 05 - White
    set colorbg $color00 # Base 00 - Black

    if test -n "$TMUX"
      # Tell tmux to pass the escape sequences through
      # (Source: http://permalink.gmane.org/gmane.comp.terminal-emulators.tmux.user/1324)
      function put_template; printf '\033Ptmux;\033\033]4;%d;rgb:%s\033\033\\\033\\' $argv; end;
      function put_template_var; printf '\033Ptmux;\033\033]%d;rgb:%s\033\033\\\033\\' $argv; end;
      function put_template_custom; printf '\033Ptmux;\033\033]%s%s\033\033\\\033\\' $argv; end;
    else if string match 'screen*' $TERM # [ "${TERM%%[-.]*}" = "screen" ]
      # GNU screen (screen, screen-256color, screen-256color-bce)
      function put_template; printf '\033P\033]4;%d;rgb:%s\007\033\\' $argv; end;
      function put_template_var; printf '\033P\033]%d;rgb:%s\007\033\\' $argv; end;
      function put_template_custom; printf '\033P\033]%s%s\007\033\\' $argv; end;
    else if string match 'linux*' $TERM # [ "${TERM%%-*}" = "linux" ]
      function put_template; test $argv[1] -lt 16 && printf "\e]P%x%s" $argv[1] (echo $argv[2] | sed 's/\///g'); end;
      function put_template_var; true; end;
      function put_template_custom; true; end;
    else
      function put_template; printf '\033]4;%d;rgb:%s\033\\' $argv; end;
      function put_template_var; printf '\033]%d;rgb:%s\033\\' $argv; end;
      function put_template_custom; printf '\033]%s%s\033\\' $argv; end;
    end

    # 16 color space
    put_template 0  $color00
    put_template 1  $color01
    put_template 2  $color02
    put_template 3  $color03
    put_template 4  $color04
    put_template 5  $color05
    put_template 6  $color06
    put_template 7  $color07
    put_template 8  $color08
    put_template 9  $color09
    put_template 10 $color10
    put_template 11 $color11
    put_template 12 $color12
    put_template 13 $color13
    put_template 14 $color14
    put_template 15 $color15

    # 256 color space
    put_template 16 $color16
    put_template 17 $color17
    put_template 18 $color18
    put_template 19 $color19
    put_template 20 $color20
    put_template 21 $color21

    # foreground / background / cursor color
    if test -n "$ITERM_SESSION_ID"
      # iTerm2 proprietary escape codes
      put_template_custom Pg d5c4a1 # foreground
      put_template_custom Ph 1d2021 # background
      put_template_custom Pi d5c4a1 # bold color
      put_template_custom Pj 504945 # selection color
      put_template_custom Pk d5c4a1 # selected text color
      put_template_custom Pl d5c4a1 # cursor
      put_template_custom Pm 1d2021 # cursor text
    else
      put_template_var 10 $colorfg
      if [ "$BASE16_SHELL_SET_BACKGROUND" != false ]
        put_template_var 11 $colorbg
        if string match 'rxvt*' $TERM # [ "${TERM%%-*}" = "rxvt" ]
          put_template_var 708 $colorbg # internal border (rxvt)
        end
      end
      put_template_custom 12 ";7" # cursor (reverse video)
    end

    # set syntax highlighting colors
    set -U fish_color_autosuggestion 504945
    set -U fish_color_cancel -r
    set -U fish_color_command green #white
    set -U fish_color_comment 504945
    set -U fish_color_cwd green
    set -U fish_color_cwd_root red
    set -U fish_color_end brblack #blue
    set -U fish_color_error red
    set -U fish_color_escape yellow #green
    set -U fish_color_history_current --bold
    set -U fish_color_host normal
    set -U fish_color_match --background=brblue
    set -U fish_color_normal normal
    set -U fish_color_operator blue #green
    set -U fish_color_param bdae93
    set -U fish_color_quote yellow #brblack
    set -U fish_color_redirection cyan
    set -U fish_color_search_match bryellow --background=504945
    set -U fish_color_selection white --bold --background=504945
    set -U fish_color_status red
    set -U fish_color_user brgreen
    set -U fish_color_valid_path --underline
    set -U fish_pager_color_completion normal
    set -U fish_pager_color_description yellow --dim
    set -U fish_pager_color_prefix white --bold #--underline
    set -U fish_pager_color_progress brwhite --background=cyan

    # remember current theme
    set -U base16_theme gruvbox-dark-hard

    # clean up
    functions -e put_template put_template_var put_template_custom
  end
#+end_src
* Fonts
See font directory.

Installation of the fonts
#+begin_src sh :tangle no :dir ~/.dotfiles
  mkdir ~/.fonts
  cp -r resources/fonts/.fonts/* ~/.fonts/
#+end_src

#+RESULTS:

* Git
General settings
#+begin_src conf :tangle ~/.gitconfig
  [user]
  name = Olivier Lischer
  useConfigOnly = true

  [include]
    path = ~/.gitconfig.personal

  [includeIf "gitdir:~/code/private/"]
    path = ~/.gitconfig.personal

  [includeIf "gitdir:~/code/work/"]
    path = ~/.gitconfig.work

  [includeIf "gitdir:~/code/school/"]
    path = ~/.gitconfig.school

  [pull]
  rebase = true

  [merge]
  conflictstyle = diff3

  [commit]
  gpgsign = true
#+end_src

Private settings
#+begin_src conf :tangle ~/.gitconfig.personal
  [user]
  email = olivier.lischer@liolin.ch
  signingKey = 6B52B67EDA21CAF6
#+end_src

Settings for work
#+begin_src conf :tangle ~/.gitconfig.work
  [user]
  email = olivier.lischer@ost.ch
  signingKey = DC67BB979C90E477
#+end_src

Settings for school
#+begin_src conf :tangle ~/.gitconfig.school
  [user]
  email = olivier.lischer@ost.ch
  signingKey = DC67BB979C90E477
#+end_src
** Required Packages                                               :packages:
#+begin_example
git
#+end_example

* GPG
** TODO gpg-agent-info
** gpg.conf
#+begin_src conf :tangle ~/.gnupg/gpg.conf
  # https://github.com/drduh/config/blob/master/gpg.conf
  # https://www.gnupg.org/documentation/manuals/gnupg/GPG-Configuration-Options.html
  # https://www.gnupg.org/documentation/manuals/gnupg/GPG-Esoteric-Options.html
  # Use AES256, 192, or 128 as cipher
  personal-cipher-preferences AES256 AES192 AES
  # Use SHA512, 384, or 256 as digest
  personal-digest-preferences SHA512 SHA384 SHA256
  # Use ZLIB, BZIP2, ZIP, or no compression
  personal-compress-preferences ZLIB BZIP2 ZIP Uncompressed
  # Default preferences for new keys
  default-preference-list SHA512 SHA384 SHA256 AES256 AES192 AES ZLIB BZIP2 ZIP Uncompressed
  # SHA512 as digest to sign keys
  cert-digest-algo SHA512
  # SHA512 as digest for symmetric ops
  s2k-digest-algo SHA512
  # AES256 as cipher for symmetric ops
  s2k-cipher-algo AES256
  # UTF-8 support for compatibility
  charset utf-8
  # Show Unix timestamps
  fixed-list-mode
  # No comments in signature
  no-comments
  # No version in signature
  no-emit-version
  # Disable banner
  no-greeting
  # Long hexidecimal key format
  keyid-format 0xlong
  # Display UID validity
  list-options show-uid-validity
  verify-options show-uid-validity
  # Display all keys and their fingerprints
  with-fingerprint
  # Display key origins and updates
  #with-key-origin
  # Cross-certify subkeys are present and valid
  require-cross-certification
  # Disable caching of passphrase for symmetrical ops
  no-symkey-cache
  # Enable smartcard
  use-agent
  # Disable recipient key ID in messages
  throw-keyids
  # Default/trusted key ID to use (helpful with throw-keyids)
  #default-key 0xFF3E7D88647EBCDB
  #trusted-key 0xFF3E7D88647EBCDB
  # Keyserver URL
  #keyserver hkps://keys.openpgp.org
  #keyserver hkps://keyserver.ubuntu.com:443
  #keyserver hkps://hkps.pool.sks-keyservers.net
  #keyserver hkps://pgp.ocf.berkeley.edu
  # Proxy to use for keyservers
  #keyserver-options http-proxy=socks5-hostname://127.0.0.1:9050
  # Verbose output
  #verbose
#+end_src
** gpg-agent.conf
#+begin_src conf :tangle ~/.gnupg/gpg-agent.conf
  pinentry-program /usr/bin/pinentry-gtk
  ## Set timeout for passphrase unlock to 8 hours
  default-cache-ttl 28800
  max-cache-ttl 28800

  ## Set timeout for SSH key unlock
  enable-ssh-support
  default-cache-ttl-ssh 28800
  max-cache-ttl-ssh 28800
#+end_src

** sshcontrol
#+begin_src conf :tangle ~/.gnupg/sshcontrol
  # List of allowed ssh keys.  Only keys present in this file are used
  # in the SSH protocol.  The ssh-add tool may add new entries to this
  # file to enable them; you may also add them manually.  Comment
  # lines, like this one, as well as empty lines are ignored.  Lines do
  # have a certain length limit but this is not serious limitation as
  # the format of the entries is fixed and checked by gpg-agent. A
  # non-comment line starts with optional white spaces, followed by the
  # keygrip of the key given as 40 hex digits, optionally followed by a
  # caching TTL in seconds, and another optional field for arbitrary
  # flags.   Prepend the keygrip with an '!' mark to disable it.
  90783C7BE49932998FB01359A3958092318E442A
  AA5405839AA1F5CD202349D701D4F9697041ECA6
  !48ED9915566EAD80A32C2DAE3C6A23629ADC0BB4
#+end_src

* SSH
** config
#+begin_src conf :tangle ~/.ssh/config
  Host liolin.ch
    SetEnv TERM=xterm

  Host smartkvp.ch
    HostName 104.236.200.192
    SetEnv TERM=xterm

  Host smartkvp-openshift.ch
    HostName 165.22.34.246
    SetEnv TERM=xterm
#+end_src
* X11
** starx / .xinitrc
#+begin_src sh :tangle ~/.xinitrc
  systemctl --user import-environment DISPLAY XAUTHORITY

  if command -v dbus-update-activation-environment >/dev/null 2>&1; then
      dbus-update-activation-environment DISPLAY XAUTHORITY
  fi

  exec i3
#+end_src
* i3
#+begin_src conf :tangle ~/.config/i3/config
  font Ubuntu:monospace 11
  ### Set WM Name
  exec wmname LG3D

  ### Variables
  set $mod Mod4
  set $left h
  set $down j
  set $up k
  set $right l
  set $term kitty

  set $locker i3lock -i ~/.config/i3/lockscreen.png

  # Note: pass the final command to swaymsg so that the resulting window can be opened
  # on the original workspace that the command was run on.
  set $menu rofi -show-icons -show drun
  set $calc rofi -show calc -modi calc -no-show-match -no-sort

  set $external_mon HDMI-A-1
  set $external_mon_home HDMI-A-3
  set $internal_mon eDP-1

  set $base00 #1d2021
  set $base01 #3c3836
  set $base02 #504945
  set $base03 #665c54
  set $base04 #bdae93
  set $base05 #d5c4a1
  set $base06 #ebdbb2
  set $base07 #fbf1c7
  set $base08 #fb4934
  set $base09 #fe8019
  set $base0A #fabd2f
  set $base0B #b8bb26
  set $base0C #8ec07c
  set $base0D #83a598
  set $base0E #d3869b
  set $base0F #d65d0e

  ### Colors
  # Basic color configuration using the Base16 variables for windows and borders.
  # Property Name         Border  BG      Text    Indicator Child Border
  client.focused          $base05 $base0D $base00 $base0D $base0D
  client.focused_inactive $base01 $base01 $base05 $base03 $base01
  client.unfocused        $base01 $base00 $base05 $base01 $base01
  client.urgent           $base08 $base08 $base00 $base08 $base08
  client.placeholder      $base00 $base00 $base05 $base00 $base00
  client.background       $base07

  default_border pixel 3

  ### Key bindings
  #
  # Basics:
  #
  # Start a terminal
  bindsym $mod+Return exec $term

  # Kill focused window
  bindsym $mod+Shift+c kill

  # Start your launcher
  bindsym $mod+r exec $menu
  bindsym $mod+c exec $calc

  # Drag floating windows by holding down $mod and left mouse button.
  floating_modifier $mod

  # Reload the configuration file
  bindsym $mod+Shift+r reload

  #
  # Moving around:
  #
  # Move your focus around
  bindsym $mod+$left focus left
  bindsym $mod+$down focus down
  bindsym $mod+$up focus up
  bindsym $mod+$right focus right

  bindsym $mod+w focus output left
  bindsym $mod+e focus output right

  # Move the focused window with the same, but add Shift
  bindsym $mod+Shift+$left move left
  bindsym $mod+Shift+$down move down
  bindsym $mod+Shift+$up move up
  bindsym $mod+Shift+$right move right

  #
  # Workspaces:
  #
  workspace_auto_back_and_forth yes
  # Switch to workspace
  bindsym $mod+1 workspace number 1
  bindsym $mod+2 workspace number 2
  bindsym $mod+3 workspace number 3
  bindsym $mod+4 workspace number 4
  bindsym $mod+5 workspace number 5
  bindsym $mod+6 workspace number 6
  bindsym $mod+7 workspace number 7
  bindsym $mod+8 workspace number 8
  bindsym $mod+9 workspace number 9
  bindsym $mod+0 workspace number 10
  # Move focused container to workspace
  bindsym $mod+Shift+1 move container to workspace number 1
  bindsym $mod+Shift+2 move container to workspace number 2
  bindsym $mod+Shift+3 move container to workspace number 3
  bindsym $mod+Shift+4 move container to workspace number 4
  bindsym $mod+Shift+5 move container to workspace number 5
  bindsym $mod+Shift+6 move container to workspace number 6
  bindsym $mod+Shift+7 move container to workspace number 7
  bindsym $mod+Shift+8 move container to workspace number 8
  bindsym $mod+Shift+9 move container to workspace number 9
  bindsym $mod+Shift+0 move container to workspace number 10

  bindsym $mod+Shift+w move workspace to output left
  bindsym $mod+Shift+e move workspace to output right


  #
  # Layout stuff:
  #
  # You can "split" the current object of your focus with
  # $mod+b or $mod+v, for horizontal and vertical splits
  # respectively.
  bindsym $mod+b splith
  bindsym $mod+v splitv

  # Make the current focus fullscreen
  bindsym $mod+f fullscreen

  # Toggle the current focus between tiling and floating mode
  bindsym $mod+Shift+space floating toggle

  # Swap focus between the tiling area and the floating area
  bindsym $mod+space focus mode_toggle

  # Move focus to the parent container
  bindsym $mod+a focus parent

  #
  # Scratchpad:
  #
  # Move the currently focused window to the scratchpad
  bindsym $mod+Shift+minus move scratchpad

  # Show the next scratchpad window or hide the focused scratchpad window.
  # If there are multiple scratchpad windows, this command cycles through them.
  bindsym $mod+minus scratchpad show

  #
  # Resizing containers:
  #
  mode "resize" {
      bindsym $left resize shrink width 10px
      bindsym $down resize grow height 10px
      bindsym $up resize shrink height 10px
      bindsym $right resize grow width 10px

      # Return to default mode
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+Shift+s mode "resize"

  #
  # Status Bar:
  bar {
      position bottom
      font pango:DejaVu Sans Mono, FontAwesome 12
      colors {
          background  $base00
      }
      status_command i3status-rs
  }

  ### Launch Application
  bindsym Print exec /usr/bin/flameshot gui
  bindsym XF86AudioMute exec /usr/bin/pamixer --toggle-mute
  bindsym XF86AudioLowerVolume exec /usr/bin/pamixer --decrease 5
  bindsym XF86AudioRaiseVolume exec /usr/bin/pamixer --increase 5
  bindsym XF86AudioMicMute exec /usr/bin/pamixer --default-source --toggle-mute
  bindsym XF86AudioPlay exec /usr/bin/playerctl play-pause
  bindsym XF86AudioPrev exec /usr/bin/playerctl previous
  bindsym XF86AudioNext exec /usr/bin/playerctl next
  bindsym XF86MonBrightnessUp exec /usr/bin/brightnessctl set 5%+
  bindsym XF86MonBrightnessDown exec /usr/bin/brightnessctl set 5%-

  ### Dunstctl
  set $dunst_mode "Dunst: [c]lose close_[a]ll [h]istory conte[x]"
  mode $dunst_mode {
      bindsym c exec dunstctl close; mode "default"
      bindsym a exec dunstctl close-all; mode "default"
      bindsym h exec dunstctl history-pop; mode "default"
      bindsym x exec dunstctl context; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+n mode $dunst_mode

  set $emacs_mode "Emacs Options: [e]macs [b]uffers [d]ired [m]u4e [s]hell [a]genda [c]alc"
  mode $emacs_mode {
      bindsym e exec emacsclient -c -a ''; mode "default"
      bindsym b exec emacsclient -c -a '' --eval '(ibuffer)'; mode "default"
      bindsym d exec emacsclient -c -a '' --eval '(dired nil)'; mode "default"
      bindsym m exec emacsclient -c -a '' --eval '(mu4e)'; mode "default"
      bindsym s exec emacsclient -c -a '' --eval '(eshell)'; mode "default"
      bindsym a exec emacsclient -c -a '' --eval '(org-agenda)'; mode "default"
      bindsym c exec emacsclient -c -a '' --eval '(full-calc)'; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+d mode $emacs_mode

  set $software_mode "Software Options: [p]df"
  mode $software_mode {
      bindsym p exec /usr/bin/evince; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+s mode $software_mode

  set $prompt_mode "[p]ass [e]xit action"
  mode $prompt_mode {
      bindsym p exec /usr/bin/passmenu -i; mode "default"
      bindsym e exec /home/liolin/.local/bin/exac; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+p mode $prompt_mode

  set $system_mode "System (l) lock, (e) logout, (s) suspend, (h) hibernate, (r) reboot, (CTRL+s) shutdown"
  mode $system_mode {
       bindsym l exec --no-startup-id $locker; mode "default"
       bindsym e exec --no-startup-id i3-msg exit; mode "deafult"
       bindsym s exec --no-startup-id $locker -f && sleep 2 && systemctl suspend; mode "default"
       bindsym h exec --no-startup-id $locker -f && sleep 2 && systemctl hibernate; mode "default"
       bindsym r exec --no-startup-id systemctl reboot; mode "default"
       bindsym Ctrl+s exec --no-startup-id systemctl poweroff -i; mode "default"

       # back to normal: Enter or Escape
       bindsym Return mode "default"
       bindsym Escape mode "default"
  }
  bindsym $mod+BackSpace mode $system_mode

  ## Start default services
  exec --no-startup-id dunst
  exec --no-startup-id nm-applet
  exec --no-startup-id picom --backend glx --daemon --config ~/.config/picom.conf
  exec --no-startup-id feh --bg-scale ~/Pictures/wallpapers/0020.png
  exec --no-startup-id setxkbmap -layout us -variant "altgr-intl" -option ctrl:nocaps
  exec --no-startup-id playerctld daemon
  exec --no-startup-id udiskie --no-automount --tray
  exec --no-startup-id owncloud
  exec --no-startup-id redshift -l 47.04896000:9.44103000 # Sargans

  exec --no-startup-id gsettings set org.gnome.desktop.interface gtk-theme "gruvbox-dark-gtk"
  exec --no-startup-id gsettings set org.gnome.desktop.interface icon-theme "Yaru-dark"
  exec --no-startup-id gsettings set org.gnome.desktop.interface cursor-theme "Yaru"
  exec --no-startup-id gsettings set org.gnome.desktop.interface font-name "Ubuntu 11"

#+end_src
** Required Packages                                               :packages:
#+begin_example
i3
rofi
rofi-calc
picom
pipewire
wireplumber
pipewire-alsa
pipewire-pulse
gruvbox-dark-gtk
gruvbox-dark-icons-gtk
#+end_example

* i3status-rs
#+begin_src toml :tangle ~/.config/i3status-rust/config.toml

  icons_format = "{icon}"

  [theme]
  theme = "gruvbox-dark"

  [icons]
  icons = "awesome4"

  [[block]]
  block = "focused_window"
  [block.theme_overrides]
  idle_bg = "#458588"
  idle_fg = "#ebdbb2"

  [[block]]
  block = "memory"
  interval = 30
  warning_mem = 70
  critical_mem = 90

  [[block]]
  block = "battery"

  [[block]]
  block = "temperature"

  [[block]]
  block = "sound"
  [[block.click]]
  button = "left"
  cmd = "/usr/bin/pamixer --toggle-mute"

  [[block]]
  block = "net"
  format = "$icon {$ssid}"
  format_alt = "$icon {$ip}"

  [[block]]
  block = "time"
  interval = 5
  [block.format]
  full = " $icon $timestamp.datetime(f:'%a %Y-%m-%d %R', l:en_GB) "
  short = " $icon $timestamp.datetime(f:%R) "
#+end_src
* sway
#+begin_src conf :tangle ~/.config/sway/colortheme
  ## Base16 Gruvbox dark, hard
  # Author: Dawid Kurek (dawikur@gmail.com), morhetz (https://github.com/morhetz/gruvbox)

  set $base00 #1d2021
  set $base01 #3c3836
  set $base02 #504945
  set $base03 #665c54
  set $base04 #bdae93
  set $base05 #d5c4a1
  set $base06 #ebdbb2
  set $base07 #fbf1c7
  set $base08 #fb4934
  set $base09 #fe8019
  set $base0A #fabd2f
  set $base0B #b8bb26
  set $base0C #8ec07c
  set $base0D #83a598
  set $base0E #d3869b
  set $base0F #d65d0e
  #+end_src
#+begin_src conf :tangle ~/.config/sway/config
  ### Set WM Name
  exec wmname LG3D

  ### Variables
  set $mod Mod4
  set $left h
  set $down j
  set $up k
  set $right l
  set $term kitty

  set $locker swaylock -k -l -i ~/Pictures/wallpapers/0020.png

  # Note: pass the final command to swaymsg so that the resulting window can be opened
  # on the original workspace that the command was run on.
  set $menu rofi -show-icons -show drun

  set $external_mon HDMI-A-1
  set $external_mon_home HDMI-A-3
  set $internal_mon eDP-1

  include ~/.config/sway/colortheme

  ### Colors
  # Basic color configuration using the Base16 variables for windows and borders.
  # Property Name         Border  BG      Text    Indicator Child Border
  client.focused          $base05 $base0D $base00 $base0D $base0D
  client.focused_inactive $base01 $base01 $base05 $base03 $base01
  client.unfocused        $base01 $base00 $base05 $base01 $base01
  client.urgent           $base08 $base08 $base00 $base08 $base08
  client.placeholder      $base00 $base00 $base05 $base00 $base00
  client.background       $base07

  ### Autostart
  #exec ~/.config/autostart.sh

  ### Output configuration
  output * bg ~/Pictures/wallpapers/0020.png fill
  output $internal_mon resolution 1920x1080 position 2560,0
  output $external_mon resolution 2560x1440 position 0,0
  output $external_mon_home resolution 2560x1440 position 0,0
  #output $external_mon resolution 2560x1440 position 660,0
  #focus output $external_mon # primary focus on $external mon
  # You can get the names of your outputs by running: swaymsg -t get_outputs

  default_border pixel 3

  ### Idle configuration
  exec swayidle -w \
       timeout 180 '$locker' \
       timeout 300 'swaymsg "output * dpms off"' \
       resume 'swaymsg "output * dpms on"' \
       before-sleep '$locker'
  #
  # This will lock your screen after 300 seconds of inactivity, then turn off
  # your displays after another 300 seconds, and turn your screens back on when
  # resumed. It will also lock your screen before your computer goes to sleep.


  ### Input configuration
  #
  input "type:keyboard" {
        # for more information see man setxkbmap
        xkb_layout us(altgr-intl),ch
        xkb_options grp:alt_space_toggle,ctrl:nocaps
  }
  # You can get the names of your inputs by running: swaymsg -t get_inputs
  # Read `man 5 sway-input` for more information about this section.

  ### Key bindings
  #
  # Basics:
  #
  # Start a terminal
  bindsym $mod+Return exec $term

  # Kill focused window
  bindsym $mod+Shift+c kill

  # Start your launcher
  bindsym $mod+r exec $menu

  # Drag floating windows by holding down $mod and left mouse button.
  # Resize them with right mouse button + $mod.
  # Despite the name, also works for non-floating windows.
  # Change normal to inverse to use left mouse button for resizing and right
  # mouse button for dragging.
  floating_modifier $mod normal

  # Reload the configuration file
  bindsym $mod+Shift+r reload

  #
  # Moving around:
  #
  # Move your focus around
  bindsym $mod+$left focus left
  bindsym $mod+$down focus down
  bindsym $mod+$up focus up
  bindsym $mod+$right focus right

  bindsym $mod+w focus output left
  bindsym $mod+e focus output right

  # Move the focused window with the same, but add Shift
  bindsym $mod+Shift+$left move left
  bindsym $mod+Shift+$down move down
  bindsym $mod+Shift+$up move up
  bindsym $mod+Shift+$right move right

  #
  # Workspaces:
  #
  workspace_auto_back_and_forth yes
  # Switch to workspace
  bindsym $mod+1 workspace number 1
  bindsym $mod+2 workspace number 2
  bindsym $mod+3 workspace number 3
  bindsym $mod+4 workspace number 4
  bindsym $mod+5 workspace number 5
  bindsym $mod+6 workspace number 6
  bindsym $mod+7 workspace number 7
  bindsym $mod+8 workspace number 8
  bindsym $mod+9 workspace number 9
  bindsym $mod+0 workspace number 10
  # Move focused container to workspace
  bindsym $mod+Shift+1 move container to workspace number 1
  bindsym $mod+Shift+2 move container to workspace number 2
  bindsym $mod+Shift+3 move container to workspace number 3
  bindsym $mod+Shift+4 move container to workspace number 4
  bindsym $mod+Shift+5 move container to workspace number 5
  bindsym $mod+Shift+6 move container to workspace number 6
  bindsym $mod+Shift+7 move container to workspace number 7
  bindsym $mod+Shift+8 move container to workspace number 8
  bindsym $mod+Shift+9 move container to workspace number 9
  bindsym $mod+Shift+0 move container to workspace number 10
  # Note: workspaces can have any name you want, not just numbers.
  # We just use 1-10 as the default.

  bindsym $mod+Shift+w move workspace to output left
  bindsym $mod+Shift+e move workspace to output right


  #
  # Layout stuff:
  #
  # You can "split" the current object of your focus with
  # $mod+b or $mod+v, for horizontal and vertical splits
  # respectively.
  bindsym $mod+b splith
  bindsym $mod+v splitv

  # Make the current focus fullscreen
  bindsym $mod+f fullscreen

  # Toggle the current focus between tiling and floating mode
  bindsym $mod+Shift+space floating toggle

  # Swap focus between the tiling area and the floating area
  bindsym $mod+space focus mode_toggle

  # Move focus to the parent container
  bindsym $mod+a focus parent

  #
  # Scratchpad:
  #
  # Sway has a "scratchpad", which is a bag of holding for windows.
  # You can send windows there and get them back later.

  # Move the currently focused window to the scratchpad
  bindsym $mod+Shift+minus move scratchpad

  # Show the next scratchpad window or hide the focused scratchpad window.
  # If there are multiple scratchpad windows, this command cycles through them.
  bindsym $mod+minus scratchpad show
  #
  # Resizing containers:
  #
  mode "resize" {
      bindsym $left resize shrink width 10px
      bindsym $down resize grow height 10px
      bindsym $up resize shrink height 10px
      bindsym $right resize grow width 10px

      # Return to default mode
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+Shift+s mode "resize"

  #
  # Status Bar:
  #
  # Read `man 5 sway-bar` for more information about this section.
  bar {
      position top
      swaybar_command waybar
  }

  ### Launch Application
  bindsym Print exec grim -g "$(slurp)" - | ksnip -
  bindsym XF86AudioMute exec /usr/bin/pamixer --toggle-mute
  bindsym XF86AudioLowerVolume exec /usr/bin/pamixer --decrease 5
  bindsym XF86AudioRaiseVolume exec /usr/bin/pamixer --increase 5
  bindsym XF86AudioMicMute exec /usr/bin/pamixer --default-source --toggle-mute
  bindsym XF86AudioPlay exec /usr/bin/playerctl play-pause
  bindsym XF86AudioPrev exec /usr/bin/playerctl previous
  bindsym XF86AudioNext exec /usr/bin/playerctl next
  bindsym XF86MonBrightnessUp exec /usr/bin/brightnessctl set 5%+
  bindsym XF86MonBrightnessDown exec /usr/bin/brightnessctl set 5%-

  ### Dunstctl
  set $dunst_mode "Dunst: [c]lose close_[a]ll [h]istory conte[x]"
  mode $dunst_mode {
      bindsym c exec dunstctl close; mode "default"
      bindsym a exec dunstctl close-all; mode "default"
      bindsym h exec dunstctl history-pop; mode "default"
      bindsym x exec dunstctl context; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+n mode $dunst_mode

  set $emacs_mode "Emacs Options: [e]macs [b]uffers [d]ispatcher [m]u4e [s]hell [a]genda [c]alc [t]ype"
  mode $emacs_mode {
      bindsym e exec emacsclient -c -a ''; mode "default"
      bindsym b exec emacsclient -c -a '' --eval '(ibuffer)'; mode "default"
      bindsym d exec emacsclient -c -a '' --eval '(liomacs/dispatch-entry)'; mode "default"
      bindsym m exec emacsclient -c -a '' --eval '(mu4e)'; mode "default"
      bindsym s exec emacsclient -c -a '' --eval '(eshell)'; mode "default"
      bindsym a exec emacsclient -c -a '' --eval '(org-agenda)'; mode "default"
      bindsym c exec emacsclient -c -a '' --eval '(full-calc)'; mode "default"
      bindsym t exec emacsclient -a '' --eval '(thanos/type)'; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+d mode $emacs_mode


  set $rmpc_mode "[b]reak, [u]npause, [n]ext, [p]rev"
  mode $rmpc_mode {
      bindsym b exec rmpc pause; mode "default"
      bindsym u exec rmpc unpause; mode "default"
      bindsym n exec rmpc next; mode "default"
      bindsym p exec rmpc prev; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+m mode $rmpc_mode

  set $software_mode "Software Options: [p]df"
  mode $software_mode {
      bindsym p exec /usr/bin/evince; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+s mode $software_mode

  set $prompt_mode "[p]ass [e]xit action"
  mode $prompt_mode {
      bindsym p exec /usr/bin/passmenu -i; mode "default"
      bindsym e exec /home/liolin/.local/bin/exac; mode "default"
      bindsym Return mode "default"
      bindsym Escape mode "default"
  }
  bindsym $mod+p mode $prompt_mode

  set $system_mode "System (l) lock, (e) logout, (s) suspend, (h) hibernate, (r) reboot, (CTRL+s) shutdown"
  mode $system_mode {
       bindsym l exec --no-startup-id $locker; mode "default"
       bindsym e exec --no-startup-id swaymsg exit; mode "deafult"
       bindsym s exec --no-startup-id $locker -f && sleep 2 && systemctl suspend; mode "default"
       bindsym h exec --no-startup-id $locker -f && sleep 2 && systemctl hibernate; mode "default"
       bindsym r exec --no-startup-id systemctl reboot; mode "default"
       bindsym Ctrl+s exec --no-startup-id systemctl poweroff -i; mode "default"

       # back to normal: Enter or Escape
       bindsym Return mode "default"
       bindsym Escape mode "default"
  }
  bindsym $mod+BackSpace mode $system_mode

  ## Start default services
  exec dunst
  exec nm-applet
  exec playerctld daemon
  exec udiskie --no-automount --tray
  exec owncloud
  exec gammastep -l 47.04896000:9.44103000 # Sargans

  exec gsettings set org.gnome.desktop.interface gtk-theme "gruvbox-dark-gtk"
  exec gsettings set org.gnome.desktop.interface icon-theme "Yaru-dark"
  exec gsettings set org.gnome.desktop.interface cursor-theme "Yaru"
  exec gsettings set org.gnome.desktop.interface font-name "Ubuntu 11"

  for_window [app_id="pavucontrol"] {
      move scratchpad
  }
  bindsym $mod+Shift+p [app_id="pavucontrol"] scratchpad show


  bindswitch tablet:on exec 'swaymsg input 1386:20925:Wacom_Pen_and_multitouch_sensor_Finger map_to_output eDP-1', \
      exec 'swaymsg input 1386:20925:Wacom_Pen_and_multitouch_sensor_Pen map_to_output eDP-1'
  bindswitch tablet:off exec 'swaymsg input 1386:20925:Wacom_Pen_and_multitouch_sensor_Finger map_to_output eDP-1', \
      exec 'swaymsg input 1386:20925:Wacom_Pen_and_multitouch_sensor_Pen map_to_output eDP-1'

  include /etc/sway/config.d/*

  exec rot8 &
#+end_src
** Required Packages                                               :packages:
#+begin_example
sway
swaylock
swayidle
swaybg
dmenu-wayland-git
grim
slurp
ksnip
wofi
pipewire
wireplumber
pipewire-alsa
pipewire-pulse
xdg-desktop-portal-wlr
qt5-wayland
qt6-wayland
waybar
nwg-look
gruvbox-dark-gtk
gruvbox-dark-icons-gtk
wl-clipboard
rot8
create dmenu-wl script (=wofi --dmenu "$@"=)
#+end_example

* Hyprland
#+begin_src conf :tangle ~/.config/hypr/hyprland.conf
  # See https://wiki.hyprland.org/Configuring/Monitors/
  monitor=HDMI-A-1, 2560x1440, 0x0, 1
  monitor=eDP-1, 1920x1080, 2560x0, 1


  # See https://wiki.hyprland.org/Configuring/Keywords/ for more

  # Execute your favorite apps at launch
  # exec-once = waybar & hyprpaper & firefox
  exec-once = waybar & dunst & nm-applet & playerctld daemon & owncloud
  exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

  $locker = swaylock -k -l -i ~/Pictures/wall_anime_8K.png

  # Source a file (multi-file configs)
  # source = ~/.config/hypr/myColors.conf

  # Some default env vars.
  env = XCURSOR_SIZE,24

  # For all categories, see https://wiki.hyprland.org/Configuring/Variables/
  input {
      kb_layout = us
      kb_variant = altgr-intl
      kb_model =
      kb_options = caps:ctrl_modifier
      kb_rules =

      follow_mouse = 1

      touchpad {
          natural_scroll = no
      }

      sensitivity = 0 # -1.0 - 1.0, 0 means no modification.
  }

  general {
      # See https://wiki.hyprland.org/Configuring/Variables/ for more

      gaps_in = 2
      gaps_out = 1
      border_size = 2
      col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
      col.inactive_border = rgba(595959aa)

      layout = dwindle
  }

  decoration {
      # See https://wiki.hyprland.org/Configuring/Variables/ for more

      rounding = 0

      blur {
         enabled = yes
         size = 3
         passes = 1
         new_optimizations = on
      }

      drop_shadow = yes
      shadow_range = 4
      shadow_render_power = 3
      col.shadow = rgba(1a1a1aee)
  }

  animations {
      enabled = false

      # Some default animations, see https://wiki.hyprland.org/Configuring/Animations/ for more

      bezier = myBezier, 0.05, 0.9, 0.1, 1.05

      animation = windows, 1, 7, myBezier
      animation = windowsOut, 1, 7, default, popin 80%
      animation = border, 1, 10, default
      animation = borderangle, 1, 8, default
      animation = fade, 1, 7, default
      animation = workspaces, 1, 6, default
  }

  dwindle {
      # See https://wiki.hyprland.org/Configuring/Dwindle-Layout/ for more
      pseudotile = yes # master switch for pseudotiling. Enabling is bound to mainMod + P in the keybinds section below
      preserve_split = yes # you probably want this
  }

  master {
      # See https://wiki.hyprland.org/Configuring/Master-Layout/ for more
      new_is_master = true
  }

  gestures {
      # See https://wiki.hyprland.org/Configuring/Variables/ for more
      workspace_swipe = off
  }

  # Example per-device config
  # See https://wiki.hyprland.org/Configuring/Keywords/#executing for more
  device:epic-mouse-v1 {
      sensitivity = -0.5
  }

  binds {
      workspace_back_and_forth = true
  }

  # Example windowrule v1
  # windowrule = float, ^(kitty)$
  # Example windowrule v2
  # windowrulev2 = float,class:^(kitty)$,title:^(kitty)$
  # See https://wiki.hyprland.org/Configuring/Window-Rules/ for more


  # See https://wiki.hyprland.org/Configuring/Keywords/ for more
  $mainMod = SUPER
  $left = h
  $up = k
  $right = l
  $down = j

  ## General keybindings
  bind = $mainMod, RETURN, exec, kitty
  bind = $mainMod SHIFT, C, killactive,
  bind = $mainMod, R, exec, wofi --allow-images --show drun
  bind = $mainMod SHIFT, Q, exit,
  bind = $mainMod, SPACE, togglefloating,
  bind = $mainMod, F, fullscreen
  #bind = $mainMod, P, pseudo, # dwindle
  #bind = $mainMod, J, togglesplit, # dwindle

  ## Move and focus keybindings
  # Move focus using home row for window and W / E for monitor
  bind = $mainMod, $right, movefocus, r
  bind = $mainMod, $up, movefocus, u
  bind = $mainMod, $down, movefocus, d
  bind = $mainMod, $left, movefocus, l
  bind = $mainMod, W, focusmonitor, -1
  bind = $mainMod, E, focusmonitor, +1

  # Move window using home row
  bind = $mainMod SHIFT, $right, movewindow, r
  bind = $mainMod SHIFT, $up, movewindow, u
  bind = $mainMod SHIFT, $down, movewindow, d
  bind = $mainMod SHIFT, $left, movewindow, l

  # Switch workspaces with mainMod + [0-9]
  bind = $mainMod, 1, workspace, 1
  bind = $mainMod, 2, workspace, 2
  bind = $mainMod, 3, workspace, 3
  bind = $mainMod, 4, workspace, 4
  bind = $mainMod, 5, workspace, 5
  bind = $mainMod, 6, workspace, 6
  bind = $mainMod, 7, workspace, 7
  bind = $mainMod, 8, workspace, 8
  bind = $mainMod, 9, workspace, 9
  bind = $mainMod, 0, workspace, 10

  # Move active window to a workspace with mainMod + SHIFT + [0-9]
  bind = $mainMod SHIFT, 1, movetoworkspacesilent, 1
  bind = $mainMod SHIFT, 2, movetoworkspacesilent, 2
  bind = $mainMod SHIFT, 3, movetoworkspacesilent, 3
  bind = $mainMod SHIFT, 4, movetoworkspacesilent, 4
  bind = $mainMod SHIFT, 5, movetoworkspacesilent, 5
  bind = $mainMod SHIFT, 6, movetoworkspacesilent, 6
  bind = $mainMod SHIFT, 7, movetoworkspacesilent, 7
  bind = $mainMod SHIFT, 8, movetoworkspacesilent, 8
  bind = $mainMod SHIFT, 9, movetoworkspacesilent, 9
  bind = $mainMod SHIFT, 0, movetoworkspacesilent, 10

  # Move active workspace to monitor
  bind = $mainMod SHIFT, W, movecurrentworkspacetomonitor, -1
  bind = $mainMod SHIFT, E, movecurrentworkspacetomonitor, +1

  # Mouse Bindings
  bindm=ALT,mouse:272,movewindow

  ## Resize (does noething currently)
  bind = $mainMod SHIFT, S, submap,resize
  submap=resize
  bind = ,J, resizeactive, -10
  bind = ,K, resizeactive, +10

  bind = ,escape,submap,reset
  bind = ,return,submap,reset
  submap=reset


  ## Applications
  # Emacs
  $emacsMode = Emacs Options: [e]macs [b]uffers [d]ired [m]u4e [s]hell [a]genda
  bind = $mainMod,D,submap,$emacsMode
  submap=$emacsMode
  bind = ,E, exec, emacsclient -c -a ''
  bind = ,B, exec, emacsclient -c -a '' --eval '(ibuffer)'
  bind = ,D, exec, emacsclient -c -a '' --eval '(dired nil)'
  bind = ,M, exec, emacsclient -c -a '' --eval '(mu4e)'
  bind = ,S, exec, emacsclient -c -a '' --eval '(eshell)'
  bind = ,A, exec, emacsclient -c -a '' --eval '(org-agenda)'

  bind = ,E,submap,reset
  bind = ,B,submap,reset
  bind = ,D,submap,reset
  bind = ,M,submap,reset
  bind = ,S,submap,reset
  bind = ,A,submap,reset
  bind = ,escape,submap,reset
  bind = ,return,submap,reset
  submap = reset


  # Start general applications
  $softwareMode = Software Options: [p]df
  bind = $mainMod,S,submap,$softwareMode
  submap = $softwareMode
  bind = ,P, exec, evince

  bind = ,P,submap,reset
  bind = ,escape,submap,reset
  bind = ,return,submap,reset
  submap = reset

  # Start prompts
  $promptMode = [p]ass [e]xit action
  bind = $mainMod,P,submap,$promptMode
  submap = $promptMode
  bind = ,P, exec, passmenu -i
  bind = ,E, exec, exac

  bind = ,P,submap,reset
  bind = ,E,submap,reset
  bind = ,escape,submap,reset
  bind = ,return,submap,reset
  submap = reset

  # Launch Powermenu
  $systemMode = System (l) lock, (e) logout, (s) suspend, (h) hibernate, (r) reboot, (CTRL+s) shutdown
  bind = $mainMod,BACKSPACE,submap,$systemMode
  submap = $systemMode
  bind = ,L, exec, $locker
  bind = ,E, exec, exit
  bind = ,S, exec, $locker -f && sleep 2 && systemctl suspend
  bind = ,H, exec, $locker -f && sleep 2 && systemctl hibernate
  bind = ,R, exec, systemctl reboot
  bind = CTRL,S, exec, systemctl poweroff -i

  bind = ,L,submap,reset
  bind = ,E,submap,reset
  bind = ,S,submap,reset
  bind = ,H,submap,reset
  bind = ,R,submap,reset
  bind = CTRL,S,submap,reset
  bind = ,escape,submap,reset
  bind = ,return,submap,reset
  submap = reset

  ## Multimedia
  bind = $mainMod,Print, exec, grim -g "$(slurp)" - | wl-copy
  bind = ,Print, exec, grim -g "$(slurp)"
  bind = ,XF86AudioMute, exec, /usr/bin/pamixer --toggle-mute
  bind = ,XF86AudioLowerVolume, exec, /usr/bin/pamixer --decrease 5
  bind = ,XF86AudioRaiseVolume, exec, /usr/bin/pamixer --increase 5
  bind = ,XF86AudioMicMute, exec, /usr/bin/pamixer --default-source --toggle-mute
  bind = ,XF86AudioPlay, exec, /usr/bin/playerctl play-pause
  bind = ,XF86AudioPrev, exec, /usr/bin/playerctl previous
  bind = ,XF86AudioNext, exec, /usr/bin/playerctl next
  bind = ,XF86MonBrightnessUp, exec, /usr/bin/brightnessctl set 5%+
  bind = ,XF86MonBrightnessDown, exec, /usr/bin/brightnessctl set 5%-

#+end_src

** dmenu-wl
##+begin_src sh :tangle ~/.local/bin/dmenu-wl :tangle-mode (identity #o555)
#+begin_src sh
  #!/usr/bin/env bash
  set -Eeu
  wofi --dmenu "$@"
#+end_src

** dmenu-fzf
#+begin_src sh :tangle ~/.local/bin/dmenu-wl :tangle-mode (identity #o555)
  #!/usr/bin/bash

  SCRIPTNAME=$(basename $0)
  SCRIPTPATH="$(cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P)"
  IFS=$'\n'

  prompt="> "
  header=""

  if [[ -n $DMENU_FZF_FIFO ]]; then
      str=$(cat $DMENU_FZF_FIFO)

      selection=$(printf $str | fzf --header=$header --prompt="$prompt")
      echo $selection > $DMENU_FZF_FIFO
      exit
  fi

  columns=0
  lines=0
  str=""

  while read -r line; do
      if [[ ${#line} -gt $columns ]]; then
          columns=${#line}
      fi
      lines=$((lines+1))
      str="$str\n$line"
  done

  lines=$((lines+3))
  columns=$((columns+"${#header}"+5))

  if [[ lines -gt 50 ]]; then
      lines=50
  fi
  if [[ columns -gt 100 ]]; then
      columns=100
  fi

  fifo=/tmp/dmenu-fzf-$(date +%s)
  mkfifo $fifo

  DMENU_FZF_FIFO=$fifo $SHELL -c "kitty -o window.dimensions.columns=$columns -o window.dimensions.lines=$lines --title="fzf-switcher" -e $SCRIPTPATH/$SCRIPTNAME" &

  pid=$!

  echo -n $str > $fifo

  cat $fifo
  rm $fifo
#+end_src
** Required Packages                                               :packages:
#+begin_example
hyprland
pipewire
wireplumber
pipewire-alsa
pipewire-pulse
xdg-desktop-portal-hyprland
qt5-wayland
qt6-wayland
waybar
wofi
nwg-look
gruvbox-dark-gtk
gruvbox-dark-icons-gtk
wl-clipboard
create dmenu-wl script (=wofi --dmenu "$@"=)
#+end_example

* Waybar
** Config
#+begin_src json :tangle ~/.config/waybar/config
  {
        "height": 30, // Waybar height (to be removed for auto height)
        "position": "bottom",
        "layer": "top",
        "modules-left": ["sway/workspaces"],
        "modules-center": ["sway/mode", "sway/window"],
        "modules-right": ["idle_inhibitor", "wireplumber", "memory", "disk", "network", "sway/language", "battery", "clock", "tray"],


        "sway/workspaces": {
          "sort-by-number": true,
          "format": "{name}: {icon}",
          "format-icons": {
              "1": "",
              "2": "",
              "3": " ",
              "4": "",
              "5": "",
              "6": "",
              "7": "",
              "8": "",
              "9": "",
              "10": "",
              "urgent": "",
              "default": ""
          },
          "on-click": "activate"
        },
        "sway/mode": {
          "format": "<span style=\"italic\">{}</span>",
          "tooltip": false
        },
        "keyboard-state": {
          "numlock": true,
          "capslock": true,
          "format": "{name} {icon}",
          "format-icons": {
              "locked": "",
              "unlocked": ""
          }
        },
        "idle_inhibitor": {
          "format": "{icon}",
          "format-icons": {
              "activated": "",
              "deactivated": ""
          }
        },
        "tray": {
          // "icon-size": 21,
          "spacing": 10
        },
        "clock": {
          "timezone": "Europe/Zurich",
          "tooltip-format": "<big>{:%Y %B}</big>\n<tt><small>{calendar}</small></tt>",
          "format": "{:%Y-%m-%d %H:%M}",
        },
        "battery": {
          "states": {
              // "good": 95,
              "warning": 30,
              "critical": 15
          },
          "format": "{capacity}% {icon}",
          "format-charging": "{capacity}% ",
          "format-plugged": "{capacity}% ",
          "format-alt": "{time} {icon}",
          "format-icons": ["", "", "", "", ""]
        },
        "network": {
          "format-wifi": "{essid} ({signalStrength}%) ",
          "format-ethernet": "{ipaddr}/{cidr} ",
          "tooltip-format": "{ifname} via {gwaddr} ",
          "format-linked": "{ifname} (No IP) ",
          "format-disconnected": "Disconnected ",
          "format-alt": "{ifname}: {ipaddr}/{cidr}"
        },
        "wireplumber": {
          "format": "{volume}% {icon}",
          "format-muted": "",
          "format-icons": ["", "", ""]
        },
        "memory": {
          "interval": 30,
          "format": "\uf2db {used:0.1f}G/{total:0.1f}G",
          "states": {
              "warning": 70,
              "critical": 90
          }
        },
        "disk": {
          "interval": 30,
          "format": " {used}/{total}",
          "unit": "GB",
          "states": {
              "warning": 70,
              "critical": 90
          }
        }
  }


#+end_src
** Style
#+begin_src css :tangle ~/.config/waybar/colorscheme.css
  /*
  ,*
  ,* Base16 Gruvbox dark, hard
  ,* Author: Dawid Kurek (dawikur@gmail.com), morhetz (https://github.com/morhetz/gruvbox)
  ,*
  ,*/

  @define-color base00 #1d2021;
  @define-color base01 #3c3836;
  @define-color base02 #504945;
  @define-color base03 #665c54;
  @define-color base04 #bdae93;
  @define-color base05 #d5c4a1;
  @define-color base06 #ebdbb2;
  @define-color base07 #fbf1c7;
  @define-color base08 #fb4934;
  @define-color base09 #fe8019;
  @define-color base0A #fabd2f;
  @define-color base0B #b8bb26;
  @define-color base0C #8ec07c;
  @define-color base0D #83a598;
  @define-color base0E #d3869b;
  @define-color base0F #d65d0e;
#+end_src

#+begin_src css :tangle ~/.config/waybar/style.css
  @import "colorscheme.css";

  ,* {
    /* `otf-font-awesome` is required to be installed for icons */
    font-family: Roboto, Helvetica, Arial, sans-serif;
    font-size: 12px;
  }

  window#waybar {
    background-color: @base01;
    border-bottom: 3px solid @base01;
    color: @base05;
    transition-property: background-color;
    transition-duration: .5s;
  }

  window#waybar.hidden {
    opacity: 0.2;
  }

  #workspaces button {
    padding: 0 5px;
    background-color: transparent;
    color: @base07;
    /* Use box-shadow instead of border so the text isn't offset */
    box-shadow: inset 0 -3px transparent;
    /* Avoid rounded borders under each workspace name */
    border: none;
    border-radius: 0;
  }

  #workspaces button:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  #workspaces button.focused,
  #workspaces button.active {
    background-color: @base0C;
  }

  #workspaces button.urgent {
    background-color: @base08;
  }

  #mode {
    background-color: #64727D;
    border-bottom: 3px solid #ffffff;
  }

  #clock,
  #battery,
  #cpu,
  #memory,
  #disk,
  #temperature,
  #backlight,
  #network,
  #pulseaudio,
  #wireplumber,
  #custom-media,
  #tray,
  #mode,
  #idle_inhibitor,
  #language,
  #keyboard-state,
  #mpd {
    padding: 0 10px;
    color: @base07;
  }

  #window,
  #workspaces {
    padding: 0 10px 0 0;
    margin: 0 4px;
  }

  /* If workspaces is the leftmost module, omit left margin */
  .modules-left > widget:first-child > #workspaces {
    margin-left: 0;
  }

  /* If workspaces is the rightmost module, omit right margin */
  .modules-right > widget:last-child > #workspaces {
    margin-right: 0;
  }

  #battery.charging {
    color: #ffffff;
    background-color: @base0C;
  }

  @keyframes blink {
  to {
    background-color: #ffffff;
    color: #000000;
  }
  }

  #battery.critical:not(.charging) {
    background-color: @base08;
    animation-name: blink;
    animation-duration: 0.5s;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    animation-direction: alternate;
  }

  #tray > .passive {
    -gtk-icon-effect: dim;
  }

  #tray > .needs-attention {
    -gtk-icon-effect: highlight;
    background-color: #eb4d4b;
  }

  #language {
    min-width: 16px;
  }

  #keyboard-state {
    min-width: 16px;
  }

  #keyboard-state > label {
    padding: 0 5px;
  }

  #keyboard-state > label.locked {
    background: rgba(0, 0, 0, 0.2);
  }

#+end_src
* lxsession
#+begin_src conf :tangle ~/.config/systemd/user/lxsession.service
  [Unit]
  Description=lxsession - polkit

  [Service]
  Type=simple
  ExecStart=/usr/bin/lxpolkit
  ExecStop=/usr/bin/killall lxpolkit
  Restart=on-failure

  [Install]
  WantedBy=default.target
#+end_src

** Required Packages                                               :packages:
#+begin_example
polkit
lxsession
#+end_example

* mailsignature
#+begin_src conf :tangle ~/.signature
  Olivier Lischer
  Ersalinstrasse 3
  7411 Sils im Domleschg
  olivier.lischer@liolin.ch
  keybase.io: liolin
#+end_src

* mbsync
** olivier.lischer@liolin.ch
#+begin_src conf :tangle ~/.mbsyncrc
  IMAPAccount olivier.lischer@liolin.ch
  # Address to connect to
  Host imap.mail.hostpoint.ch
  User olivier.lischer@liolin.ch
  # To store the password in an encrypted file use PassCmd instead of Pass
  PassCmd "pass show Privat/Communication/Mail/olivier.lischer@liolin.ch | head -n1"
  #PassCmd "gpg2 -q --for-your-eyes-only --no-tty -d ~/.mailpass.gpg"
  #
  # Use SSL
  TLSType IMAPS
  # The following line should work. If get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
  CertificateFile /etc/ssl/certs/ca-certificates.crt
  #CertificateFile ~/.cert/imap.gmail.com.pem
  #CertificateFile ~/.cert/Equifax_Secure_CA.pem

  IMAPStore olivier.lischer@liolin.ch-remote
  Account olivier.lischer@liolin.ch

  MaildirStore olivier.lischer@liolin.ch-local
  Subfolders Verbatim
  # The trailing "/" is important
  Path ~/.mail/liolin/
  Inbox ~/.mail/liolin/Inbox

  Channel olivier.lischer@liolin.ch
  Far :olivier.lischer@liolin.ch-remote:
  Near :olivier.lischer@liolin.ch-local:
  Patterns *
  Create Both
  SyncState *
  Expunge Both
  CopyArrivalDate yes
#+end_src
** liolin@liolin.ch
#+begin_src conf :tangle ~/.mbsyncrc
  IMAPAccount liolin@liolin.ch
  # Address to connect to
  Host imap.mail.hostpoint.ch
  User liolin@liolin.ch
  # To store the password in an encrypted file use PassCmd instead of Pass
  PassCmd "pass show Privat/Communication/Mail/liolin@liolin.ch | head -n1"
  #PassCmd "gpg2 -q --for-your-eyes-only --no-tty -d ~/.mailpass.gpg"
  #
  # Use SSL
  TLSType IMAPS
  # The following line should work. If get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
  CertificateFile /etc/ssl/certs/ca-certificates.crt
  #CertificateFile ~/.cert/imap.gmail.com.pem
  #CertificateFile ~/.cert/Equifax_Secure_CA.pem

  IMAPStore liolin@liolin.ch-remote
  Account liolin@liolin.ch

  MaildirStore liolin@liolin.ch-local
  Subfolders Verbatim
  # The trailing "/" is important
  Path ~/.mail/mailinglist/
  Inbox ~/.mail/mailinglist/Inbox

  Channel liolin@liolin.ch
  Far :liolin@liolin.ch-remote:
  Near :liolin@liolin.ch-local:
  Patterns *
  Create Both
  SyncState *
  Expunge Both
  CopyArrivalDate yes
#+end_src
** notes@liolin.ch
#+begin_src conf :tangle ~/.mbsyncrc
  IMAPAccount notes@liolin.ch
  # Address to connect to
  Host imap.mail.hostpoint.ch
  User notes@liolin.ch
  # To store the password in an encrypted file use PassCmd instead of Pass
  PassCmd "pass show Privat/Communication/Mail/notes@liolin.ch | head -n1"
  #
  # Use SSL
  TLSType IMAPS
  # The following line should work. If get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
  CertificateFile /etc/ssl/certs/ca-certificates.crt

  IMAPStore notes@liolin.ch-remote
  Account notes@liolin.ch

  MaildirStore notes@liolin.ch-local
  Subfolders Verbatim
  # The trailing "/" is important
  Path ~/.mail/notes/
  Inbox ~/.mail/notes/Inbox

  Channel notes@liolin.ch
  Far :notes@liolin.ch-remote:
  Near :notes@liolin.ch-local:
  Patterns *
  Create Both
  SyncState *
  Expunge Both
  CopyArrivalDate yes
#+end_src

** olivier.lischer.blong@gmail.com
#+begin_src conf :tangle ~/.mbsyncrc
  IMAPAccount olivier.lischer.blon@gmail.com
  # Address to connect to
  Host imap.gmail.com
  User olivier.lischer.blon@gmail.com
  PassCmd "gpg2 -q --for-your-eyes-only --no-tty -d ~/.gmail_mailpass.gpg"
  #
  # Use SSL
  TLSType IMAPS
  # The following line should work. If get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
  CertificateFile /etc/ssl/certs/ca-certificates.crt
  #CertificateFile ~/.cert/imap.gmail.com.pem
  #CertificateFile ~/.cert/Equifax_Secure_CA.pem

  IMAPStore olivier.lischer.blon@gmail.com-remote
  Account olivier.lischer.blon@gmail.com

  MaildirStore olivier.lischer.blon@gmail.com-local
  Subfolders Verbatim
  #The trailing "/" is important
  Path ~/.mail/gmail/
  Inbox ~/.mail/gmail/Inbox

  Channel olivier.lischer.blon@gmail.com
  Far :olivier.lischer.blon@gmail.com-remote:
  Near :olivier.lischer.blon@gmail.com-local:
  Patterns *
  Create Both
  Expunge Both
  SyncState *
  CopyArrivalDate yes
#+end_src

** olivier.lischer@ost.ch
#+begin_src conf :tangle ~/.mbsyncrc
  IMAPAccount olivier.lischer@ost.ch
  # Address to connect to
  Host 127.0.0.1
  Port 1143
  User olivier.lischer@ost.ch
  # To store the password in an encrypted file use PassCmd instead of Pass
  PassCmd "pass show Privat/School/HSR/Ost.ch/olivier.lischer@ost.ch | head -n1"
  TLSType None
  AuthMechs LOGIN

  IMAPStore olivier.lischer@ost.ch-remote
  Account olivier.lischer@ost.ch

  MaildirStore olivier.lischer@ost.ch-local
  Subfolders Verbatim
  # The trailing "/" is important
  Path ~/.mail/ost/
  Inbox ~/.mail/ost/Inbox

  Channel olivier.lischer@ost.ch
  Far :olivier.lischer@ost.ch-remote:
  Near :olivier.lischer@ost.ch-local:
  Patterns *
  Create Both
  SyncState *
  Expunge None
  CopyArrivalDate yes
#+end_src

** Required Packages                                               :packages:
#+begin_example
isync
#+end_example

* davmail
#+begin_src conf :tangle ~/.config/davmail/config
  davmail.url=https://outlook.office365.com/EWS/Exchange.asmx
  davmail.mode=O365Interactive
  davmail.server=true

  davmail.imapPort=1143
  davmail.smtpPort=1025
  davmail.caldavPort=1080
  davmail.carddavPort=1081

  davmail.ssl.nosecureimap=false
  davmail.ssl.nosecureldap=false
  davmail.ssl.nosecurecaldav=false
  davmail.ssl.nosecuresmtp=false
  davmail.ssl.nosecurepop=false

  davmail.enableKeepAlive=true

  davmail.allowRemote=false

  ######################
  # SMTP Settings
  ######################
  # let Exchange save a copy of sent messages in Sent folder
  davmail.smtpSaveInSent=true


  davmail.imapAutoExpunge=true
  # To enable IDLE support, set a maximum client polling delay in minutes
  # Clients using IDLE should poll more frequently than this delay
  davmail.imapIdleDelay=
  # Always reply to IMAP RFC822.SIZE requests with Exchange approximate message size for performance reasons
  davmail.imapAlwaysApproxMsgSize=

  davmail.logFilePath=~/.cache/davmail/davmail.log
#+end_src
* mu
** Initialize mu database
#+begin_src sh :tangle no
mu init --my-address="olivier.lischer@liolin.ch" --my-address="olivier.lischer.blon@gmail.com" --my-address="notes@liolin.ch" --my-address="liolin@liolin.ch" --maildir ~/.mail
#+end_src
** emacsmail
#+begin_src sh :tangle ~/.local/bin/emacsmail :tangle-mode (identity #o555)
  emacsclient -c --eval "(liolin/mailto \"$@\")"
#+end_src
** emacsclient-mail.desktop
#+begin_src conf :tangle ~/.local/share/applications/emacsclient-mail.desktop
[Desktop Entry]
Categories=Network;Email;
Comment=GNU Emacs is an extensible, customizable text editor - and more
Exec=/home/liolin/.local/bin/emacsmail
Icon=emacs
Name=Emacs (Mail, Client)
MimeType=x-scheme-handler/mailto;
NoDisplay=true
Terminal=false
Type=Application
Keywords=emacsclient;
Actions=new-window;new-instance;
#+end_src
** Required Packages                                               :packages:
#+begin_example
mu
meson
ninja
#+end_example

* picom
#+begin_src conf :tangle ~/.config/picom.conf
  # Shadow
  shadow = true;
  # no-dnd-shadow = true;
  # no-dock-shadow = true;
  detect-rounded-corners = true;
  shadow-radius = 5;
  shadow-offset-x = 1;
  shadow-offset-y = 1;
  shadow-opacity = .3;
  shadow-ignore-shaped = false;
  shadow-exclude = [
  "name = 'Notification'",
  # workaround for conky until it provides window properties:
  "override_redirect = 1 && !WM_CLASS@:s",
  #	"class_g ?= 'Dunst'",
  # disable shadows for hidden windows:
  "_NET_WM_STATE@:32a *= '_NET_WM_STATE_HIDDEN'",
  "_GTK_FRAME_EXTENTS@:c",
  # disables shadows on sticky windows:
  #	"_NET_WM_STATE@:32a *= '_NET_WM_STATE_STICKY'",
  # disables shadows on i3 frames
  "class_g ?= 'i3-frame'"
  ];

  # shadow-exclude-reg = "x10+0+0";
  # xinerama-shadow-crop = true;

  #menu-opacity = 0.95;
  inactive-opacity = 0.93;
  active-opacity = 1;
  #alpha-step = 0.01;
  inactive-dim = 0.0;
  blur-background = false;
  blur-kern = "3x3box";

  fading = false;
  fade-delta = 1;
  fade-in-step = 0.03;
  fade-out-step = 0.03;
  fade-exclude = [ ];

  backend = "xrender";
  mark-wmwin-focused = true;
  mark-ovredir-focused = true;
  detect-client-opacity = true;
  unredir-if-possible = true;
  vsync = true;
  dbe = false;
  #paint-on-overlay = true;
  focus-exclude = [ "class_g = 'Cairo-clock'" ];
  detect-transient = true;
  detect-client-leader = true;
  invert-color-include = [ ];
  #glx-copy-from-front = false;
  #glx-swap-method = "undefined";
  use-damage = true

  opacity-rule = [
  "99:name *?= 'Call'",
  "99:class_g = 'Chromium'",
  "99:name *?= 'Conky'",
  "99:class_g = 'Darktable'",
  "50:class_g = 'Dmenu'",
  "99:name *?= 'Event'",
  "99:class_g = 'Firefox' && focused",
  "99:name *?= 'Firefox' && focused",
  "99:class_g = 'Firefox' && !focused",
  "99:name *?= 'Firefox' && !focused",
  "99:class_g = 'GIMP'",
  "99:name *?= 'Image'",
  "99:class_g = 'Lazpaint'",
  "99:class_g = 'Midori'",
  "99:name *?= 'Minitube'",
  "99:class_g = 'Mousepad'",
  "99:name *?= 'MuseScore'",
  "90:name *?= 'Page Info'",
  "99:name *?= 'Pale Moon'",
  "90:name *?= 'Panel'",
  "99:class_g = 'Pinta'",
  "90:name *?= 'Restart'",
  "99:name *?= 'sudo'",
  "99:name *?= 'Screenshot'",
  "99:class_g = 'Viewnior'",
  "99:class_g = 'VirtualBox'",
  "99:name *?= 'VLC'",
  "99:name *?= 'mpv",
  "99:name *?= 'Write'",
  "99:class_g = 'teams-for-linux'",
  "99:class_g = 'teams'",
  "99:class_g = 'jetbrains-idea'",
  "93:class_g = 'URxvt' && !_NET_WM_STATE@:32a",
  "0:_NET_WM_STATE@:32a *= '_NET_WM_STATE_HIDDEN'",
  "96:_NET_WM_STATE@:32a *= '_NET_WM_STATE_STICKY'"
  ];

  wintypes :
  {
  tooltip :
  {
  fade = true;
  shadow = false;
  opacity = 0.85;
  focus = true;
  };
  fullscreen :
  {
  fade = true;
  shadow = false;
  opacity = 1;
  focus = true;
  };
  };
#+end_src

** Required Packages                                               :packages:
#+begin_example
picom
#+end_example

* TODO polybar
** Configuration
*** Colors
#+begin_src conf :tangle ~/.config/polybar/config
  [colors]
  background = #222
  background-alt = #444
  foreground = #dfdfdf
  foreground-alt = #555
  primary = #ffb52a
  secondary = #e60053

  underline = #97bbf7

  ; signa colors
  alert = #f90000
  warning = #f44336
  notice = #8bc34a
  ok = #4caf50
#+end_src

*** Settings
#+begin_src conf :tangle ~/.config/polybar/config
  [settings]
  screenchange-reload = true
#+end_src
*** Global
**** wm
#+begin_src conf :tangle ~/.config/polybar/config
  [global/wm]
  margin-top = 5
  margin-bottom = 5
#+end_src
*** Bars
**** default
#+begin_src conf :tangle ~/.config/polybar/config
  [bar/default]
  width = 100%
  height = 27
  radius = 6.0
  fixed-center = false

  background = ${colors.background}
  foreground = ${colors.foreground}

  line-size = 3
  line-color = #f00

  border-size = 4
  border-color = #00000000

  padding-left = 0
  padding-right = 2

  module-margin-left = 1
  module-margin-right = 2

  font-0 = fixed:pixelsize=10;1
  font-1 = unifont:fontformat=truetype:size=8:antialias=false;0
  font-2 = Font Awesome 5 Free:pixelsize=10;3
  font-3 = Font Awesome 5 Free Solid:pixelsize=10;3
  font-4 = Font Awesome 5 Brands:pixelsize=10;3
  font-5 = Material Icons:style=Regular

  modules-left = xmonad
  modules-right = filesystem pulseaudio xkeyboard backlight wlan eth battery temperature date

  tray-position = right
  tray-padding = 2

  cursor-click = pointer
  cursor-scroll = ns-resize
#+end_src

*** Modules
**** xmonad
#+begin_src conf :tangle ~/.config/polybar/config
  [module/xmonad]
  type = custom/script
  exec = /home/liolin/bin/xmonad-log
  tail = true
#+end_src

**** backlight
#+begin_src conf :tangle ~/.config/polybar/config
  [module/backlight]
  type = internal/backlight
  format = <label> <bar>
  label =  %percentage%%

  ; Only applies if <bar> is used
  bar-width = 10
  bar-indicator = |
  bar-fill = 
  bar-empty = 

  card = intel_backlight
  ;enable-scroll = true
#+end_src
**** xwindow
#+begin_src conf :tangle ~/.config/polybar/config
  [module/xwindow]
  type = internal/xwindow
  label = %title:0:30:...%
#+end_src

**** xkeyboard
#+begin_src conf :tangle ~/.config/polybar/config
  [module/xkeyboard]
  type = internal/xkeyboard
  blacklist-0 = num lock

  format-prefix = " "
  format-prefix-foreground = ${colors.foreground-alt}
  format-prefix-underline = #ffc299

  label-layout = %layout%
  label-layout-underline = #ffc299

  label-indicator-padding = 2
  label-indicator-margin = 1
  label-indicator-background = ${colors.secondary}
  label-indicator-underline = #ffc299
#+end_src

**** TODO filesystem
#+NAME: mount-points
#+begin_src emacs-lisp :noweb yes
  (let ((devices '(("COLA" . ("mount-0 = /"))
                   ("SPRITE" . ("mount-0 = /"
                                "mount-1 = /"))
                   ("BERGAMOTTE" . ("mount-0 = /")))))
    (string-join (cdr (assoc (system-name) devices)) "\n"))
#+end_src

#+begin_src conf :tangle ~/.config/polybar/config :noweb yes
  [module/filesystem]
  type = internal/fs
  interval = 25

  <<mount-points()>>

  label-mounted = %{F#0a81f5}%mountpoint%%{F-}: %percentage_used%%
  label-unmounted = %mountpoint% not mounted
  label-unmounted-foreground = ${colors.foreground-alt}
#+end_src

**** cpu
#+begin_src conf :tangle ~/.config/polybar/config
  [module/cpu]
  type = internal/cpu
  interval = 2
  format-prefix = " "
  format-prefix-foreground = ${colors.foreground-alt}
  format-underline = #ff944d
  label = %percentage:2%%
#+end_src

**** memory
#+begin_src conf :tangle ~/.config/polybar/config
  [module/memory]
  type = internal/memory
  interval = 2
  format-prefix = "Mem "
  format-prefix-foreground = ${colors.foreground-alt}
  format-underline = #ffa366
  label = %percentage_used%%
#+end_src

**** wlan
#+begin_src conf :tangle ~/.config/polybar/config
  [module/wlan]
  type = internal/network
  interface = wlan0
  interval = 3.0

  format-connected = <ramp-signal> <label-connected>
  format-connected-underline = #ff8533

  label-connected = %essid% / %local_ip%

  format-disconnected =

  ramp-signal-0 =
  ramp-signal-1 = 
  ramp-signal-foreground = ${colors.foreground-alt}
#+end_src

**** eth
#+begin_src conf :tangle ~/.config/polybar/config
  [module/eth]
  type = internal/network
  interface = enp3s0
  interval = 3.0

  format-connected-underline = #55aa55
  format-connected-prefix = " "
  format-connected-prefix-foreground = ${colors.foreground-alt}
  label-connected = %local_ip%

  format-disconnected =
#+end_src
**** date
#+begin_src conf :tangle ~/.config/polybar/config
  [module/date]
  type = internal/date
  interval = 5

  date =
  date-alt = " %Y-%m-%d"

  time = %H:%M
  time-alt = %H:%M:%S

  format-prefix = 
  format-prefix-foreground = ${colors.foreground-alt}
  format-underline = #0a6cf5

  label = %date% %time%
#+end_src
**** pulseaudio
#+begin_src conf :tangle ~/.config/polybar/config
  [module/pulseaudio]
  type = internal/pulseaudio

  format-volume = <label-volume> <bar-volume>
  label-volume =  %percentage%%
  label-volume-foreground = ${root.foreground}

  label-muted = 
  label-muted-foreground = #666

  bar-volume-width = 10
  bar-volume-foreground-0 = #55aa55
  bar-volume-foreground-1 = #55aa55
  bar-volume-foreground-2 = #55aa55
  bar-volume-foreground-3 = #55aa55
  bar-volume-foreground-4 = #55aa55
  bar-volume-foreground-5 = #f5a70a
  bar-volume-foreground-6 = #ff5555
  bar-volume-gradient = false
  bar-volume-indicator = |
  bar-volume-indicator-font = 2
  bar-volume-fill = 
  bar-volume-fill-font = 2
  bar-volume-empty = 
  bar-volume-empty-font = 2
  bar-volume-empty-foreground = ${colors.foreground-alt}
#+end_src
**** battery
#+begin_src conf :tangle ~/.config/polybar/config
  [module/battery]
  type = internal/battery
  battery = BAT0
  adapter = AC
  full-at = 98

  format-charging = <ramp-capacity> <label-charging>
  format-charging-underline = #ff751a

  format-discharging = <ramp-capacity> <label-discharging>
  format-discharging-underline = ${self.format-charging-underline}

  ; format-full-prefix =
  format-full-prefix-foreground = ${colors.foreground-alt}
  ; format-full-underline = ${self.format-charging-underline}
  format-full-underline = ${self.format-charging-underline}

  label-charging = %percentage%%
  label-discharging = %percentage%%

  ramp-capacity-0 = 
  ramp-capacity-1 = 
  ramp-capacity-2 = 
  ramp-capacity-3 = 

  ramp-capacity-foreground = ${colors.foreground-alt}
  ramp-capacity-0-foreground = ${colors.alert}
  ramp-capacity-1-foreground = ${colors.warning}
  ramp-capacity-2-foreground = ${colors.notice}
  ramp-capacity-3-foreground = ${colors.ok}
#+end_src
**** temperature
#+begin_src conf :tangle ~/.config/polybar/config
  [module/temperature]
  type = internal/temperature
  thermal-zone = 0
  warn-temperature = 60

  format = <ramp> <label>
  format-underline = #ff6600
  format-warn = <ramp> <label-warn>
  format-warn-underline = ${self.format-underline}

  label = %temperature-c%
  label-warn = %temperature-c%
  label-warn-foreground = ${colors.secondary}

  ; ramp-0 =  
  ; ramp-1 = 
  ; ramp-2 = 
  ramp-0 = 
  ramp-1 = 
  ramp-foreground = ${colors.foreground-alt}
#+end_src

** Launch script
#+begin_src sh :tangle ~/.config/polybar/launch.sh :mkdirp yes
  CONFIG_FILE="${HOME}/.config/polybar/config"

  # Terminate already running bar instances
  killall -q polybar

  # Wait until the processes have been shut down
  while pgrep -u $UID -x polybar >/dev/null; do sleep 1; done

  # Launch bar1 and bar2
  polybar -c $CONFIG_FILE example

  echo "Bars launched..."
#+end_src

** Systemd
#+begin_src conf :tangle ~/.config/systemd/user/polybar.service
  [Unit]
  Description=Polybar Panel

  [Service]
  Type=simple
  ExecStart=/usr/bin/polybar --config=/home/liolin/.config/polybar/config default
  ExecStop=/usr/bin/killall polybar
  Restart=on-failure
  RestartSec=3s

  [Install]
  WantedBy=default.target
#+end_src

The script for toggeling the polybar.
#+begin_src sh :tangle ~/.local/bin/bar-toggle
  SERVICE=polybar.service

  function start() {
      systemctl --user start $SERVICE
  }

  function stop() {
      systemctl --user stop $SERVICE
  }

  systemctl -q --user is-active $SERVICE && stop || start
#+end_src
** Required Packages                                               :packages:
#+begin_example
polybar
#+end_example

* Autostart
#+begin_src sh :tangle ~/.config/autostart.sh :tangle-mode (identity #o555)
  /usr/bin/dunst &
  /usr/bin/nm-applet &
  /usr/bin/picom --backend glx --daemon --config ~/.config/picom.conf
  #/usr/bin/setxkbmap -layout ch,us -variant ",altgr-intl" -option grp:alt_space_toggle
  /sbin/ibus-daemon -drxR
  /usr/bin/playerctld daemon
  /usr/bin/xmodmap ~/.config/xmodmap/xmodmap.conf
  /usr/bin/nitrogen --restore
  /sbin/udiskie --no-automount --tray &
  [ -x /usr/bin/redshift ] && /usr/bin/redshift -l 46.70041:9.45404 & #sils
  [ -x /usr/bin/keybase-gui ] && /usr/bin/keybase-gui &
  [ -x ~/.local/share/applications/teams.desktop ] &&  cd ~/.local/share/applications/ && gtk-launch teams.desktop
  #/bin/sh ~/bin/update-notif
  /usr/bin/owncloud &
#+end_src

** Required Packages                                               :packages:
#+begin_example
network-manager-applet (nm-applet)
picom
xorg-setxkbmap
playerctl
xorg-xmodmap
redshift
nitrogen (feh?)
udiskie
(conky)
(keybase=)
#+end_example

* rofi
** Configuration
#+begin_src conf :tangle ~/.config/rofi/config.rasi
  @theme "/usr/share/rofi/themes/gruvbox-dark-hard.rasi"
#+end_src
** TODO exac
#+begin_src python
  required=['dm-tool', 'rofi', 'dunstify']
#+end_src
trap does not work. Why?
#+begin_src sh :tangle ~/.local/bin/exac :tangle-mode (identity #o555)
  set -Eeuo pipefail

  function onError {
      MESSAGE=$1
      dunstify --appname="Exit Actions" --urgency=critical --timeout=7000 exac "${MESSAGE}"
  }


  function availabel {
      echo $1
      which $1 > /dev/null 2>&1
  }

  required=(dm-tool xscreenlock rofi dunstify)

  options="lock\nswitch_user\nsuspend\nhibernate\nreboot\npoweroff"
  action=$(
      echo -e $options | \
          rofi -dmenu -p "Which action?")

  case "$action" in
      lock)
          xsecurelock
          ;;
      switch_user)
          dm-tool switch-to-greeter
          ;;
      suspend)
          xsecurelock -- systemctl suspend
          ;;
      hibernate)
          xsecurelock -- systemctl hibernate
          ;;
      reboot)
          systemctl reboot
          ;;
      poweroff)
          systemctl poweroff
          ;;
      ,*)
          onError "== ! wrong argument ! ==
  Try again with: lock | switch_user | suspend | hibernate | reboot | shutdown"
          exit 2
  esac

  exit 0
#+end_src
** Required Packages                                               :packages:
#+begin_example
rofi
lightdm
xsecurelock
#+end_example

* scripts
** audioctl
#+begin_src sh :tangle ~/.local/bin/audioctl :tangle-mode (identity #o555)
  getDefaultSinkName() {
      pacmd stat | awk -F": " '/^Default sink name: /{print $2}'
  }

  getDefaultSinkVol() {
      pacmd list-sinks |
          awk '/^\s+name: /{indefault = $2 == "<'$(getdefaultsinkname)'>"}
              /^\s+volume: / && indefault {print $5; exit}'
  }

  toggleMuteDefaultSink() {
      pactl set-sink-mute $(getDefaultSinkName) toggle
  }

  raiseDefaultSinkVol() {
      pactl set-sink-volume $(getDefaultSinkName) +5%
  }

  lowerDefaultSinkVol() {
      pactl set-sink-volume $(getDefaultSinkName) -5%
  }

  for i in "$@"; do
      case $i in
          -m|--mute=*)
              toggleMuteDefaultSink
              shift # past argument=value
              ;;
          -r|--raise)
              raiseDefaultSinkVol
              shift # past argument=value
              ;;
          -l|--lower)
              lowerDefaultSinkVol
              shift # past argument=value
              ;;
          ,*)
              # unknown option
              ;;
      esac
  done
#+end_src
** selim
#+begin_src sh :tangle ~/.local/bin/selim :tangle-mode (identity #o555)
  dir="$1"
  /usr/bin/sxiv -o -q -r * | /usr/bin/tr '\n' '\0' | /usr/bin/xargs -I{} -0 cp {} "$dir"
#+end_src
** screenshot
- flameshot
** hl
#+begin_src sh :tangle ~/.local/bin/hl :tangle-mode (identity #o555)
  gpg --decrypt $HOME/finance/2022.journal.gpg 2> /dev/null | hledger -f- "$@"
#+end_src
** wolsprite
WoL for SPRITE
#+begin_src sh :tangle ~/.local/bin/wolsprite :tangle-mode (identity #o555)
wol a8:5e:45:56:5c:66
#+end_src
** Required Packages                                               :packages:
#+begin_example
nsxiv
flameshot
hledger
#+end_example

* starship
#+begin_src toml :tangle ~/.config/starship.toml


  "$schema" = 'https://starship.rs/config-schema.json'

  format = """
  [](color_orange)\
  $os\
  $username$hostname\
  [](bg:color_yellow fg:color_orange)\
  $directory\
  [](fg:color_yellow bg:color_aqua)\
  $git_branch\
  $git_status\
  [](fg:color_aqua bg:color_blue)\
  $c\
  $rust\
  $golang\
  $nodejs\
  $php\
  $java\
  $kotlin\
  $haskell\
  $python\
  [](fg:color_blue bg:color_bg3)\
  $docker_context\
  [](fg:color_bg3 bg:color_bg1)\
  $time\
  [ ](fg:color_bg1)\
  $nix_shell\
  $line_break$character"""

  palette = 'gruvbox_dark'

  [palettes.gruvbox_dark]
  color_fg0 = '#fbf1c7'
  color_bg1 = '#3c3836'
  color_bg3 = '#665c54'
  color_blue = '#458588'
  color_aqua = '#689d6a'
  color_green = '#98971a'
  color_orange = '#d65d0e'
  color_purple = '#b16286'
  color_red = '#cc241d'
  color_yellow = '#d79921'

  [os]
  disabled = false
  style = "bg:color_orange fg:color_fg0"

  [os.symbols]
  Windows = ""
  Ubuntu = ""
  SUSE = ""
  Raspbian = ""
  Mint = ""
  Macos = ""
  Manjaro = ""
  Linux = ""
  Gentoo = ""
  Fedora = ""
  Alpine = ""
  Amazon = ""
  Android = ""
  Arch = ""
  EndeavourOS = ""
  Artix = ""
  CentOS = ""
  Debian = ""
  Redhat = ""
  RedHatEnterprise = ""

  [username]
  show_always = true
  style_user = "bg:color_orange fg:color_fg0"
  style_root = "bg:color_orange fg:color_fg0"
  format = '[ $user]($style)'

  [hostname]
  ssh_only = false
  style = "bg:color_orange fg:color_fg0"
  format = "[@$hostname ]($style)"
  disabled = false

  [directory]
  style = "fg:color_fg0 bg:color_yellow"
  format = "[ $path ]($style)"
  truncation_length = 3
  truncation_symbol = "/"

  [directory.substitutions]
  "Documents" = " "
  "Downloads" = " "
  "Music" = " "
  "Pictures" = " "
  "code" = " "
  "org" = ""

  [git_branch]
  symbol = ""
  style = "bg:color_aqua"
  format = '[[ $symbol $branch ](fg:color_fg0 bg:color_aqua)]($style)'

  [git_status]
  style = "bg:color_aqua"
  format = '[[($all_status$ahead_behind )](fg:color_fg0 bg:color_aqua)]($style)'

  [nodejs]
  symbol = ""
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [c]
  symbol = " "
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [rust]
  symbol = ""
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [golang]
  symbol = ""
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [php]
  symbol = ""
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [java]
  symbol = " "
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [kotlin]
  symbol = ""
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [haskell]
  symbol = ""
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [python]
  symbol = ""
  style = "bg:color_blue"
  format = '[[ $symbol( $version) ](fg:color_fg0 bg:color_blue)]($style)'

  [docker_context]
  symbol = ""
  style = "bg:color_bg3"
  format = '[[ $symbol( $context) ](fg:#83a598 bg:color_bg3)]($style)'

  [time]
  disabled = false
  time_format = "%R"
  style = "bg:color_bg1"
  format = '[[  $time ](fg:color_fg0 bg:color_bg1)]($style)'

  [line_break]
  disabled = false

  [character]
  disabled = false
  success_symbol = '[](bold fg:color_green)'
  error_symbol = '[](bold fg:color_red)'
  vimcmd_symbol = '[](bold fg:color_green)'
  vimcmd_replace_one_symbol = '[](bold fg:color_purple)'
  vimcmd_replace_symbol = '[](bold fg:color_purple)'
  vimcmd_visual_symbol = '[](bold fg:color_yellow)'
#+end_src

** Required Packages                                               :packages:
#+begin_example
starship
#+end_example

* tmux
I do not use tmux at the moment (=~/.tmux.conf=)
#+begin_src conf :tangle ~/.tmux.conf
  unbind C-b
  set -g prefix C-a
  bind C-a send-prefix

  # split panes using | and -
  bind | split-window -h
  bind - split-window -v
  unbind '"'
  unbind %

  # vim-like pane resizing
  bind -r C-k resize-pane -U
  bind -r C-j resize-pane -D
  bind -r C-h resize-pane -L
  bind -r C-l resize-pane -R

  # vim-like pane switching
  bind -r k select-pane -U
  bind -r j select-pane -D
  bind -r h select-pane -L
  bind -r l select-pane -R

  # and now unbind keys
  unbind Up
  unbind Down
  unbind Left
  unbind Right

  unbind C-Up
  unbind C-Down
  unbind C-Left
  unbind C-Right

  # activate mouse wheel
  setw -g mouse on

  # reload config file
  bind r source-file ~/.tmux.conf

  # terminal color
  set -g default-terminal "screen-256color"

#+end_src

** Required Packages                                               :packages:
#+begin_example
(tmux)
#+end_example
* TTY
#+begin_src sh :tangle ~/.config/tty_colorscheme
]4;0;#1d2021\]4;1;#fb4934\]4;2;#b8bb26\]4;3;#fabd2f\]4;4;#83a598\]4;5;#d3869b\]4;6;#8ec07c\]4;7;#d5c4a1\]4;8;#665c54\]4;9;#fb4934\]4;10;#b8bb26\]4;11;#fabd2f\]4;12;#83a598\]4;13;#d3869b\]4;14;#8ec07c\]4;15;#fbf1c7\]4;16;#fe8019\]4;17;#d65d0e\]4;18;#3c3836\]4;19;#504945\]4;20;#bdae93\]4;21;#ebdbb2\]4;256;#d5c4a1\]10;#d5c4a1\]12;#d5c4a1\]13;#d5c4a1\]17;#d5c4a1\]4;232;#1d2021\]19;#1d2021\]11;#1d2021\]708;#1d2021\
#+end_src
* vim
#+begin_src vimrc :tangle ~/.vimrc
  set nocompatible
  filetype off
  set rtp+=~/.vim/bundle/Vundle.vim

  call vundle#begin()
  Plugin 'gmarik/Vundle.vim'
  Plugin 'vim-airline/vim-airline'

  " Color schemes
  Plugin 'chriskempson/base16-vim'

  " All of your Plugins must be added before the following line
  call vundle#end()


  filetype plugin indent on

  " Airline
  let g:airline_powerline_fonts = 1
  set laststatus=2

  "" Colors
  set t_Co=256
  colorscheme base16-gruvbox-dark-hard
  syntax enable

  " UI
  set ruler                       "show the cursor position all the time
  set showcmd                     "display incomplete commands
  set nu                          "show line numbers
  set cmdheight=1                 "The commandbar height
  set splitbelow                  " Horizontal splits open below current file
  set splitright                  " Vertical splits open to the right of the current file
  set wildmode=longest,list       " Pressing <Tab> shows command suggestions similar to pressing <Tab> in bash

  " Moving
  set backspace=indent,eol,start  "allow backspacing over everything in insert mode

  " Search
  set incsearch                   "do incremental searching
  set hlsearch                    "highlight search terms
  set ic                          "Ignore Case during searches
  set showmatch                   "Show matching bracets when text indicator is over them

  " Whitespaces
  set expandtab                   "use spaces instead of tabs
  set tabstop=4                   "insert 4 spaces whenever the tab key is pressed
  set shiftwidth=4                "set indentation to 4 spaces
  set autoindent                  "start new line at the same indentation level


  " Misc
  set history=50                  "keep 50 lines of command line history
  set nobackup                    " do not keep backup files, it's 70's style cluttering
  set noswapfile                  " do not write annoying intermediate swap files,
  set ttimeoutlen=50              "Solves: there is a pause when leaving insert mode
#+end_src
** Required Packages                                               :packages:
#+begin_example
vim
#+end_example

* owncloud for OST
** sync-exclude.lst
#+begin_src conf :tangle ~/.config/ownCloud/sync-exclude.lst
calendar_gmail.org
calendar_ost.org
#+end_src
** Required Packages                                               :packages:
#+begin_example
owncloud-client
gnome-keyring
#+end_example

* keybase
** Required Packages                                               :packages:
#+begin_example
keybase-gui
#+end_example

* pass
** Required Packages                                               :packages:
#+begin_example
pass
dmenu
browserpass
browserpass-firefox
xclip
#+end_example

* Latex
** Required Packages                                               :packages:
#+begin_example
texlive-most
#+end_example

* xmodmap
#+begin_src conf :tangle ~/.config/xmodmap/xmodmap.conf
  remove Lock = Caps_Lock
  keysym Caps_Lock = Control_L
  add Control = Control_L
#+end_src

* Xouranlpp
** Required Packages                                               :packages:
#+begin_example
xournalpp
#+end_example

* TODO Wireguard
** Required Packages                                               :packages:
#+begin_example
wireguard-tools
openresolv
#+end_example

* Virtual Machine Management
** Required Packages                                               :packages:
#+begin_example
virt-viewer
#+end_example

* Evince
** Required Packages                                               :packages:
#+begin_example
evince
#+end_example

* mpv
#+begin_src conf :tangle ~/.config/mpv/mpv.conf
ytdl-raw-options=yes-playlist=
#+end_src

** Required Packages                                               :packages:
#+begin_example
mpv, yt-dlp
#+end_example

* Chromium
#+begin_src conf :tangle ~/.config/chromium-flags.conf
  --ozone-platform-hint=auto
#+end_src
* eca
#+begin_src conf :tangle ~/.config/eca/config.json
  {
    "providers": {
      "llmhub": {
        "api": "openai-chat",
        "url": "https://api.llmhub.infs.ai/v1",
        "key": "",
        "models": {
            "qwen/qwen3-coder-30b": {}
         }
      }
    }
  }
#+end_src

* .NET
** Required Packages                                               :packages:
#+begin_example
dotnet-sdk
#+end_example

* UxPlay
An AirPlay Application.
It enables streaming from iPhone to Linux
** Required Packages                                               :packages:
#+begin_example
uxplay
#+end_example

* TiLP
An application to transfer files to the TI-Nspire
** Required Packages                                               :packages:
#+begin_example
tilp
#+end_example



* Local Variables
;; Local Variables:
;; eval: (add-hook 'after-save-hook (lambda ()(if (y-or-n-p "Tangle?")(org-babel-tangle))) nil t)
;; End:
